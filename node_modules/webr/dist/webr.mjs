var In=Object.create;var Ir=Object.defineProperty;var Un=Object.getOwnPropertyDescriptor;var Cn=Object.getOwnPropertyNames;var jn=Object.getPrototypeOf,Nn=Object.prototype.hasOwnProperty;var H=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var P=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Bn=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Cn(e))!Nn.call(r,s)&&s!==t&&Ir(r,s,{get:()=>e[s],enumerable:!(n=Un(e,s))||n.enumerable});return r};var Y=(r,e,t)=>(t=r!=null?In(jn(r)):{},Bn(e||!r||!r.__esModule?Ir(t,"default",{value:r,enumerable:!0}):t,r));var Qt=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i=(r,e,t)=>(Qt(r,e,"read from private field"),t?t.call(r):e.get(r)),u=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},h=(r,e,t,n)=>(Qt(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);var v=(r,e,t)=>(Qt(r,e,"access private method"),t);var _e=P(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.getUint64=O.getInt64=O.setInt64=O.setUint64=O.UINT32_MAX=void 0;O.UINT32_MAX=4294967295;function qn(r,e,t){let n=t/4294967296,s=t;r.setUint32(e,n),r.setUint32(e+4,s)}O.setUint64=qn;function Vn(r,e,t){let n=Math.floor(t/4294967296),s=t;r.setUint32(e,n),r.setUint32(e+4,s)}O.setInt64=Vn;function Jn(r,e){let t=r.getInt32(e),n=r.getUint32(e+4);return t*4294967296+n}O.getInt64=Jn;function Hn(r,e){let t=r.getUint32(e),n=r.getUint32(e+4);return t*4294967296+n}O.getUint64=Hn});var at=P(_=>{"use strict";var Yt,er,tr;Object.defineProperty(_,"__esModule",{value:!0});_.utf8DecodeTD=_.TEXT_DECODER_THRESHOLD=_.utf8DecodeJs=_.utf8EncodeTE=_.TEXT_ENCODER_THRESHOLD=_.utf8EncodeJs=_.utf8Count=void 0;var jr=_e(),it=(typeof process>"u"||((Yt=process==null?void 0:process.env)===null||Yt===void 0?void 0:Yt.TEXT_ENCODING)!=="never")&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function zn(r){let e=r.length,t=0,n=0;for(;n<e;){let s=r.charCodeAt(n++);if(s&4294967168)if(!(s&4294965248))t+=2;else{if(s>=55296&&s<=56319&&n<e){let o=r.charCodeAt(n);(o&64512)===56320&&(++n,s=((s&1023)<<10)+(o&1023)+65536)}s&4294901760?t+=4:t+=3}else{t++;continue}}return t}_.utf8Count=zn;function Xn(r,e,t){let n=r.length,s=t,o=0;for(;o<n;){let a=r.charCodeAt(o++);if(a&4294967168)if(!(a&4294965248))e[s++]=a>>6&31|192;else{if(a>=55296&&a<=56319&&o<n){let c=r.charCodeAt(o);(c&64512)===56320&&(++o,a=((a&1023)<<10)+(c&1023)+65536)}a&4294901760?(e[s++]=a>>18&7|240,e[s++]=a>>12&63|128,e[s++]=a>>6&63|128):(e[s++]=a>>12&15|224,e[s++]=a>>6&63|128)}else{e[s++]=a;continue}e[s++]=a&63|128}}_.utf8EncodeJs=Xn;var Se=it?new TextEncoder:void 0;_.TEXT_ENCODER_THRESHOLD=it?typeof process<"u"&&((er=process==null?void 0:process.env)===null||er===void 0?void 0:er.TEXT_ENCODING)!=="force"?200:0:jr.UINT32_MAX;function Gn(r,e,t){e.set(Se.encode(r),t)}function $n(r,e,t){Se.encodeInto(r,e.subarray(t))}_.utf8EncodeTE=Se!=null&&Se.encodeInto?$n:Gn;var Kn=4096;function Qn(r,e,t){let n=e,s=n+t,o=[],a="";for(;n<s;){let c=r[n++];if(!(c&128))o.push(c);else if((c&224)===192){let p=r[n++]&63;o.push((c&31)<<6|p)}else if((c&240)===224){let p=r[n++]&63,w=r[n++]&63;o.push((c&31)<<12|p<<6|w)}else if((c&248)===240){let p=r[n++]&63,w=r[n++]&63,Z=r[n++]&63,J=(c&7)<<18|p<<12|w<<6|Z;J>65535&&(J-=65536,o.push(J>>>10&1023|55296),J=56320|J&1023),o.push(J)}else o.push(c);o.length>=Kn&&(a+=String.fromCharCode(...o),o.length=0)}return o.length>0&&(a+=String.fromCharCode(...o)),a}_.utf8DecodeJs=Qn;var Zn=it?new TextDecoder:null;_.TEXT_DECODER_THRESHOLD=it?typeof process<"u"&&((tr=process==null?void 0:process.env)===null||tr===void 0?void 0:tr.TEXT_DECODER)!=="force"?200:0:jr.UINT32_MAX;function Yn(r,e,t){let n=r.subarray(e,e+t);return Zn.decode(n)}_.utf8DecodeTD=Yn});var nr=P(lt=>{"use strict";Object.defineProperty(lt,"__esModule",{value:!0});lt.ExtData=void 0;var rr=class{constructor(e,t){this.type=e,this.data=t}};lt.ExtData=rr});var ut=P(ct=>{"use strict";Object.defineProperty(ct,"__esModule",{value:!0});ct.DecodeError=void 0;var ue=class extends Error{constructor(e){super(e);let t=Object.create(ue.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:ue.name})}};ct.DecodeError=ue});var sr=P(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.timestampExtension=T.decodeTimestampExtension=T.decodeTimestampToTimeSpec=T.encodeTimestampExtension=T.encodeDateToTimeSpec=T.encodeTimeSpecToTimestamp=T.EXT_TIMESTAMP=void 0;var es=ut(),Nr=_e();T.EXT_TIMESTAMP=-1;var ts=4294967296-1,rs=17179869184-1;function Br({sec:r,nsec:e}){if(r>=0&&e>=0&&r<=rs)if(e===0&&r<=ts){let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,r),t}else{let t=r/4294967296,n=r&4294967295,s=new Uint8Array(8),o=new DataView(s.buffer);return o.setUint32(0,e<<2|t&3),o.setUint32(4,n),s}else{let t=new Uint8Array(12),n=new DataView(t.buffer);return n.setUint32(0,e),(0,Nr.setInt64)(n,4,r),t}}T.encodeTimeSpecToTimestamp=Br;function Lr(r){let e=r.getTime(),t=Math.floor(e/1e3),n=(e-t*1e3)*1e6,s=Math.floor(n/1e9);return{sec:t+s,nsec:n-s*1e9}}T.encodeDateToTimeSpec=Lr;function Fr(r){if(r instanceof Date){let e=Lr(r);return Br(e)}else return null}T.encodeTimestampExtension=Fr;function qr(r){let e=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(r.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let t=e.getUint32(0),n=e.getUint32(4),s=(t&3)*4294967296+n,o=t>>>2;return{sec:s,nsec:o}}case 12:{let t=(0,Nr.getInt64)(e,4),n=e.getUint32(0);return{sec:t,nsec:n}}default:throw new es.DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${r.length}`)}}T.decodeTimestampToTimeSpec=qr;function Vr(r){let e=qr(r);return new Date(e.sec*1e3+e.nsec/1e6)}T.decodeTimestampExtension=Vr;T.timestampExtension={type:T.EXT_TIMESTAMP,encode:Fr,decode:Vr}});var ht=P(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.ExtensionCodec=void 0;var pt=nr(),ns=sr(),ke=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(ns.timestampExtension)}register({type:e,encode:t,decode:n}){if(e>=0)this.encoders[e]=t,this.decoders[e]=n;else{let s=1+e;this.builtInEncoders[s]=t,this.builtInDecoders[s]=n}}tryToEncode(e,t){for(let n=0;n<this.builtInEncoders.length;n++){let s=this.builtInEncoders[n];if(s!=null){let o=s(e,t);if(o!=null){let a=-1-n;return new pt.ExtData(a,o)}}}for(let n=0;n<this.encoders.length;n++){let s=this.encoders[n];if(s!=null){let o=s(e,t);if(o!=null){let a=n;return new pt.ExtData(a,o)}}}return e instanceof pt.ExtData?e:null}decode(e,t,n){let s=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return s?s(e,t,n):new pt.ExtData(t,e)}};dt.ExtensionCodec=ke;ke.defaultCodec=new ke});var or=P(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.createDataView=pe.ensureUint8Array=void 0;function Jr(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new Uint8Array(r):Uint8Array.from(r)}pe.ensureUint8Array=Jr;function ss(r){if(r instanceof ArrayBuffer)return new DataView(r);let e=Jr(r);return new DataView(e.buffer,e.byteOffset,e.byteLength)}pe.createDataView=ss});var ar=P(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.Encoder=U.DEFAULT_INITIAL_BUFFER_SIZE=U.DEFAULT_MAX_DEPTH=void 0;var De=at(),os=ht(),Hr=_e(),is=or();U.DEFAULT_MAX_DEPTH=100;U.DEFAULT_INITIAL_BUFFER_SIZE=2048;var ir=class{constructor(e=os.ExtensionCodec.defaultCodec,t=void 0,n=U.DEFAULT_MAX_DEPTH,s=U.DEFAULT_INITIAL_BUFFER_SIZE,o=!1,a=!1,c=!1,p=!1){this.extensionCodec=e,this.context=t,this.maxDepth=n,this.initialBufferSize=s,this.sortKeys=o,this.forceFloat32=a,this.ignoreUndefined=c,this.forceIntegerToFloat=p,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}reinitializeState(){this.pos=0}encodeSharedRef(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}encode(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){let t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){let t=new ArrayBuffer(e),n=new Uint8Array(t),s=new DataView(t);n.set(this.bytes),this.view=s,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){if(e.length>De.TEXT_ENCODER_THRESHOLD){let s=(0,De.utf8Count)(e);this.ensureBufferSizeToWrite(5+s),this.writeStringHeader(s),(0,De.utf8EncodeTE)(e,this.bytes,this.pos),this.pos+=s}else{let s=(0,De.utf8Count)(e);this.ensureBufferSizeToWrite(5+s),this.writeStringHeader(s),(0,De.utf8EncodeJs)(e,this.bytes,this.pos),this.pos+=s}}encodeObject(e,t){let n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);let n=(0,is.ensureUint8Array)(e);this.writeU8a(n)}encodeArray(e,t){let n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(let s of e)this.doEncode(s,t+1)}countWithoutUndefined(e,t){let n=0;for(let s of t)e[s]!==void 0&&n++;return n}encodeMap(e,t){let n=Object.keys(e);this.sortKeys&&n.sort();let s=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(let o of n){let a=e[o];this.ignoreUndefined&&a===void 0||(this.encodeString(o),this.doEncode(a,t+1))}}encodeExtension(e){let t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),(0,Hr.setUint64)(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),(0,Hr.setInt64)(this.view,this.pos,e),this.pos+=8}};U.Encoder=ir});var zr=P(yt=>{"use strict";Object.defineProperty(yt,"__esModule",{value:!0});yt.encode=void 0;var as=ar(),ls={};function cs(r,e=ls){return new as.Encoder(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat).encodeSharedRef(r)}yt.encode=cs});var Xr=P(ft=>{"use strict";Object.defineProperty(ft,"__esModule",{value:!0});ft.prettyByte=void 0;function us(r){return`${r<0?"-":""}0x${Math.abs(r).toString(16).padStart(2,"0")}`}ft.prettyByte=us});var Gr=P(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});Rt.CachedKeyDecoder=void 0;var ps=at(),ds=16,hs=16,lr=class{constructor(e=ds,t=hs){this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,n){let s=this.caches[n-1];e:for(let o of s){let a=o.bytes;for(let c=0;c<n;c++)if(a[c]!==e[t+c])continue e;return o.str}return null}store(e,t){let n=this.caches[e.length-1],s={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=s:n.push(s)}decode(e,t,n){let s=this.find(e,t,n);if(s!=null)return this.hit++,s;this.miss++;let o=(0,ps.utf8DecodeJs)(e,t,n),a=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(a,o),o}};Rt.CachedKeyDecoder=lr});var mt=P(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.Decoder=q.DataViewIndexOutOfBoundsError=void 0;var cr=Xr(),ys=ht(),ee=_e(),ur=at(),pr=or(),fs=Gr(),F=ut(),Rs=r=>{let e=typeof r;return e==="string"||e==="number"},We=-1,hr=new DataView(new ArrayBuffer(0)),ms=new Uint8Array(hr.buffer);q.DataViewIndexOutOfBoundsError=(()=>{try{hr.getInt8(0)}catch(r){return r.constructor}throw new Error("never reached")})();var $r=new q.DataViewIndexOutOfBoundsError("Insufficient data"),gs=new fs.CachedKeyDecoder,dr=class{constructor(e=ys.ExtensionCodec.defaultCodec,t=void 0,n=ee.UINT32_MAX,s=ee.UINT32_MAX,o=ee.UINT32_MAX,a=ee.UINT32_MAX,c=ee.UINT32_MAX,p=gs){this.extensionCodec=e,this.context=t,this.maxStrLength=n,this.maxBinLength=s,this.maxArrayLength=o,this.maxMapLength=a,this.maxExtLength=c,this.keyDecoder=p,this.totalPos=0,this.pos=0,this.view=hr,this.bytes=ms,this.headByte=We,this.stack=[]}reinitializeState(){this.totalPos=0,this.headByte=We,this.stack.length=0}setBuffer(e){this.bytes=(0,pr.ensureUint8Array)(e),this.view=(0,pr.createDataView)(this.bytes),this.pos=0}appendBuffer(e){if(this.headByte===We&&!this.hasRemaining(1))this.setBuffer(e);else{let t=this.bytes.subarray(this.pos),n=(0,pr.ensureUint8Array)(e),s=new Uint8Array(t.length+n.length);s.set(t),s.set(n,t.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:t,pos:n}=this;return new RangeError(`Extra ${t.byteLength-n} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){this.reinitializeState(),this.setBuffer(e);let t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}*decodeMulti(e){for(this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}async decodeAsync(e){let t=!1,n;for await(let c of e){if(t)throw this.createExtraByteError(this.totalPos);this.appendBuffer(c);try{n=this.doDecodeSync(),t=!0}catch(p){if(!(p instanceof q.DataViewIndexOutOfBoundsError))throw p}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}let{headByte:s,pos:o,totalPos:a}=this;throw new RangeError(`Insufficient data in parsing ${(0,cr.prettyByte)(s)} at ${a} (${o} in the current buffer)`)}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){let n=t,s=-1;for await(let o of e){if(t&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(o),n&&(s=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(a){if(!(a instanceof q.DataViewIndexOutOfBoundsError))throw a}this.totalPos+=this.pos}}doDecodeSync(){e:for(;;){let e=this.readHeadByte(),t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){let s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e<160){let s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else{let s=e-160;t=this.decodeUtf8String(s,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)t=this.readI64();else if(e===217){let s=this.lookU8();t=this.decodeUtf8String(s,1)}else if(e===218){let s=this.lookU16();t=this.decodeUtf8String(s,2)}else if(e===219){let s=this.lookU32();t=this.decodeUtf8String(s,4)}else if(e===220){let s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===221){let s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===222){let s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===223){let s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===196){let s=this.lookU8();t=this.decodeBinary(s,1)}else if(e===197){let s=this.lookU16();t=this.decodeBinary(s,2)}else if(e===198){let s=this.lookU32();t=this.decodeBinary(s,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){let s=this.lookU8();t=this.decodeExtension(s,1)}else if(e===200){let s=this.lookU16();t=this.decodeExtension(s,2)}else if(e===201){let s=this.lookU32();t=this.decodeExtension(s,4)}else throw new F.DecodeError(`Unrecognized type byte: ${(0,cr.prettyByte)(e)}`);this.complete();let n=this.stack;for(;n.length>0;){let s=n[n.length-1];if(s.type===0)if(s.array[s.position]=t,s.position++,s.position===s.size)n.pop(),t=s.array;else continue e;else if(s.type===1){if(!Rs(t))throw new F.DecodeError("The type of key must be string or number but "+typeof t);if(t==="__proto__")throw new F.DecodeError("The key __proto__ is not allowed");s.key=t,s.type=2;continue e}else if(s.map[s.key]=t,s.readCount++,s.readCount===s.size)n.pop(),t=s.map;else{s.key=null,s.type=1;continue e}}return t}}readHeadByte(){return this.headByte===We&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=We}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new F.DecodeError(`Unrecognized array type byte: ${(0,cr.prettyByte)(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new F.DecodeError(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})}pushArrayState(e){if(e>this.maxArrayLength)throw new F.DecodeError(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.push({type:0,size:e,array:new Array(e),position:0})}decodeUtf8String(e,t){var n;if(e>this.maxStrLength)throw new F.DecodeError(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw $r;let s=this.pos+t,o;return this.stateIsMapKey()&&(!((n=this.keyDecoder)===null||n===void 0)&&n.canBeCached(e))?o=this.keyDecoder.decode(this.bytes,s,e):e>ur.TEXT_DECODER_THRESHOLD?o=(0,ur.utf8DecodeTD)(this.bytes,s,e):o=(0,ur.utf8DecodeJs)(this.bytes,s,e),this.pos+=t+e,o}stateIsMapKey(){return this.stack.length>0?this.stack[this.stack.length-1].type===1:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new F.DecodeError(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw $r;let n=this.pos+t,s=this.bytes.subarray(n,n+e);return this.pos+=t+e,s}decodeExtension(e,t){if(e>this.maxExtLength)throw new F.DecodeError(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let n=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){let e=(0,ee.getUint64)(this.view,this.pos);return this.pos+=8,e}readI64(){let e=(0,ee.getInt64)(this.view,this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}};q.Decoder=dr});var yr=P(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.decodeMulti=C.decode=C.defaultDecodeOptions=void 0;var Kr=mt();C.defaultDecodeOptions={};function bs(r,e=C.defaultDecodeOptions){return new Kr.Decoder(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decode(r)}C.decode=bs;function ws(r,e=C.defaultDecodeOptions){return new Kr.Decoder(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeMulti(r)}C.decodeMulti=ws});var Yr=P(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.ensureAsyncIterable=X.asyncIterableFromStream=X.isAsyncIterable=void 0;function Qr(r){return r[Symbol.asyncIterator]!=null}X.isAsyncIterable=Qr;function xs(r){if(r==null)throw new Error("Assertion Failure: value must not be null nor undefined")}async function*Zr(r){let e=r.getReader();try{for(;;){let{done:t,value:n}=await e.read();if(t)return;xs(n),yield n}}finally{e.releaseLock()}}X.asyncIterableFromStream=Zr;function Es(r){return Qr(r)?r:Zr(r)}X.ensureAsyncIterable=Es});var tn=P(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.decodeStream=j.decodeMultiStream=j.decodeArrayStream=j.decodeAsync=void 0;var fr=mt(),Rr=Yr(),gt=yr();async function vs(r,e=gt.defaultDecodeOptions){let t=(0,Rr.ensureAsyncIterable)(r);return new fr.Decoder(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeAsync(t)}j.decodeAsync=vs;function Ts(r,e=gt.defaultDecodeOptions){let t=(0,Rr.ensureAsyncIterable)(r);return new fr.Decoder(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeArrayStream(t)}j.decodeArrayStream=Ts;function en(r,e=gt.defaultDecodeOptions){let t=(0,Rr.ensureAsyncIterable)(r);return new fr.Decoder(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decodeStream(t)}j.decodeMultiStream=en;function Ps(r,e=gt.defaultDecodeOptions){return en(r,e)}j.decodeStream=Ps});var wt=P(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.decodeTimestampExtension=d.encodeTimestampExtension=d.decodeTimestampToTimeSpec=d.encodeTimeSpecToTimestamp=d.encodeDateToTimeSpec=d.EXT_TIMESTAMP=d.ExtData=d.ExtensionCodec=d.Encoder=d.DataViewIndexOutOfBoundsError=d.DecodeError=d.Decoder=d.decodeStream=d.decodeMultiStream=d.decodeArrayStream=d.decodeAsync=d.decodeMulti=d.decode=d.encode=void 0;var _s=zr();Object.defineProperty(d,"encode",{enumerable:!0,get:function(){return _s.encode}});var rn=yr();Object.defineProperty(d,"decode",{enumerable:!0,get:function(){return rn.decode}});Object.defineProperty(d,"decodeMulti",{enumerable:!0,get:function(){return rn.decodeMulti}});var bt=tn();Object.defineProperty(d,"decodeAsync",{enumerable:!0,get:function(){return bt.decodeAsync}});Object.defineProperty(d,"decodeArrayStream",{enumerable:!0,get:function(){return bt.decodeArrayStream}});Object.defineProperty(d,"decodeMultiStream",{enumerable:!0,get:function(){return bt.decodeMultiStream}});Object.defineProperty(d,"decodeStream",{enumerable:!0,get:function(){return bt.decodeStream}});var nn=mt();Object.defineProperty(d,"Decoder",{enumerable:!0,get:function(){return nn.Decoder}});Object.defineProperty(d,"DataViewIndexOutOfBoundsError",{enumerable:!0,get:function(){return nn.DataViewIndexOutOfBoundsError}});var Ss=ut();Object.defineProperty(d,"DecodeError",{enumerable:!0,get:function(){return Ss.DecodeError}});var ks=ar();Object.defineProperty(d,"Encoder",{enumerable:!0,get:function(){return ks.Encoder}});var Ds=ht();Object.defineProperty(d,"ExtensionCodec",{enumerable:!0,get:function(){return Ds.ExtensionCodec}});var Ws=nr();Object.defineProperty(d,"ExtData",{enumerable:!0,get:function(){return Ws.ExtData}});var de=sr();Object.defineProperty(d,"EXT_TIMESTAMP",{enumerable:!0,get:function(){return de.EXT_TIMESTAMP}});Object.defineProperty(d,"encodeDateToTimeSpec",{enumerable:!0,get:function(){return de.encodeDateToTimeSpec}});Object.defineProperty(d,"encodeTimeSpecToTimestamp",{enumerable:!0,get:function(){return de.encodeTimeSpecToTimestamp}});Object.defineProperty(d,"decodeTimestampToTimeSpec",{enumerable:!0,get:function(){return de.decodeTimestampToTimeSpec}});Object.defineProperty(d,"encodeTimestampExtension",{enumerable:!0,get:function(){return de.encodeTimestampExtension}});Object.defineProperty(d,"decodeTimestampExtension",{enumerable:!0,get:function(){return de.decodeTimestampExtension}})});var M=class extends Error{constructor(e){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}},rt=class extends M{},D=class extends M{},z=class extends M{};var x=typeof process<"u"&&process.release&&process.release.name==="node",Zt;if(globalThis.document)Zt=r=>new Promise((e,t)=>{let n=document.createElement("script");n.src=r,n.onload=()=>e(),n.onerror=t,document.head.appendChild(n)});else if(globalThis.importScripts)Zt=async r=>{try{globalThis.importScripts(r)}catch(e){if(e instanceof TypeError)await Promise.resolve().then(()=>Y(H(r)));else throw e}};else if(x)Zt=async r=>{let e=(await Promise.resolve().then(()=>Y(H("path")))).default;await Promise.resolve().then(()=>Y(H(e.resolve(r))))};else throw new M("Cannot determine runtime environment");function le(){let r={resolve:t=>{},reject:t=>{},promise:null},e=new Promise((t,n)=>{r.resolve=t,r.reject=n});return r.promise=e,r}function Ur(r){return new Promise(e=>setTimeout(e,r))}function I(r,e,t,...n){return r===null||typeof r!="object"?r:e(r)?t(r,...n):Array.isArray(r)||ArrayBuffer.isView(r)?r.map(s=>I(s,e,t,...n)):Object.fromEntries(Object.entries(r).map(([s,o],a)=>[s,I(o,e,t,...n)]))}function nt(r,e){let t=new XMLHttpRequest;t.open("get",r,!0),t.onload=()=>{let n=new Worker(URL.createObjectURL(new Blob([t.responseText])));e(n)},t.send()}function ce(r){if(x)return!1;let e=new URL(location.href),t=new URL(r,location.origin);return!(e.host===t.host&&e.port===t.port&&e.protocol===t.protocol)}var Ln=new WeakMap;function Cr(r,e){return Ln.set(r,e),r}var st=63;function ot(){let r=Array.from({length:4},Fn).join("-");if(r.length!==st)throw new Error("comlink internal error: UUID has the wrong length");return r}function Fn(){let r=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16),e=15-r.length;return e>0&&(r=Array.from({length:e},()=>0).join("")+r),r}var on=Y(wt());var As=new TextEncoder;async function an(r,e,t){try{let{taskId:n,sizeBuffer:s,dataBuffer:o,signalBuffer:a}=e,c=(0,on.encode)(t),p=c.length<=o.length;if(Atomics.store(s,0,c.length),Atomics.store(s,1,+p),!p){let[w,Z]=Ms(r);o.set(As.encode(w)),await sn(a,n),o=(await Z).dataBuffer}o.set(c),Atomics.store(s,1,1),await sn(a,n)}catch(n){console.warn(n)}}function Ms(r){let e=ot();return[e,new Promise(t=>{x?r.once("message",n=>{!n.id||n.id!==e||t(n)}):r.addEventListener("message",function n(s){!s.data||!s.data.id||s.data.id!==e||(r.removeEventListener("message",n),t(s.data))}),r.start&&r.start()})]}async function sn(r,e){let t=(e>>1)%32,n=1;for(;Atomics.compareExchange(r,t+1,0,e)!==0;)await Ur(n),n<32&&(n*=2);Atomics.or(r,0,1<<t),Atomics.notify(r,0)}var N,B,Ae,mr,he=class{constructor(){u(this,Ae);u(this,N,void 0);u(this,B,void 0);h(this,B,[]),h(this,N,[])}reset(){h(this,B,[]),h(this,N,[])}put(e){i(this,B).length||v(this,Ae,mr).call(this),i(this,B).shift()(e)}async get(){return i(this,N).length||v(this,Ae,mr).call(this),i(this,N).shift()}isEmpty(){return!i(this,N).length}isBlocked(){return!!i(this,B).length}get length(){return i(this,N).length-i(this,B).length}};N=new WeakMap,B=new WeakMap,Ae=new WeakSet,mr=function(){i(this,N).push(new Promise(e=>{i(this,B).push(e)}))};function vt(r,e){return ln({type:"request",data:{uuid:ot(),msg:r}},e)}function gr(r,e,t){return ln({type:"response",data:{uuid:r,resp:e}},t)}function ln(r,e){return e&&Cr(r,e),r}function cn(r,e){return{type:"sync-request",data:{msg:r,reqData:e}}}function un(r){let e=new rt(r.obj.message);return r.obj.name!=="Error"&&(e.name=r.obj.name),e.stack=r.obj.stack,e}function Os(r){return r&&typeof r=="object"&&"payloadType"in r&&"obj"in r}function Tt(r){return Os(r)&&r.payloadType==="ptr"}var ye,fe=class{constructor(){this.inputQueue=new he;this.outputQueue=new he;this.systemQueue=new he;u(this,ye,new Map)}async read(){return await this.outputQueue.get()}async flush(){let e=[];for(;!this.outputQueue.isEmpty();)e.push(await this.read());return e}async readSystem(){return await this.systemQueue.get()}write(e){this.inputQueue.put(e)}async request(e,t){let n=vt(e,t),{resolve:s,reject:o,promise:a}=le();return i(this,ye).set(n.data.uuid,{resolve:s,reject:o}),this.write(n),a}putClosedMessage(){this.outputQueue.put({type:"closed"})}resolveResponse(e){let t=e.data.uuid,n=i(this,ye).get(t);if(n){let s=e.data.resp;i(this,ye).delete(t),s.payloadType==="err"?n.reject(un(s)):n.resolve(s)}else console.warn("Can't find request.")}};ye=new WeakMap;var dn=Y(wt());var Us=new TextDecoder("utf-8"),Re,me,Me,Oe,ge,_t=class{constructor(e,t,n=[]){u(this,Re,!1);u(this,me,void 0);u(this,Me,void 0);u(this,Oe,void 0);u(this,ge,void 0);this.syncifier=new br;this.endpoint=e,this.msg=t,this.transfers=n,h(this,me,!1)}scheduleSync(){if(!i(this,Re))return h(this,Re,!0),this.syncifier.scheduleTask(this),h(this,ge,this.doSync()),i(this,ge).next(),this}poll(){if(!i(this,Re))throw new Error("Task not synchronously scheduled");let{done:e,value:t}=i(this,ge).next();return e?(h(this,me,!0),h(this,Me,t),!0):!1}*doSync(){let{endpoint:e,msg:t,transfers:n}=this,s=new Int32Array(new SharedArrayBuffer(8)),o=this.signalBuffer,a=this.taskId,c=pn(st),p=cn(t,{sizeBuffer:s,dataBuffer:c,signalBuffer:o,taskId:a});if(e.postMessage(p,n),yield,Atomics.load(s,1)===0){let Z=Us.decode(c.slice(0,st));Cs(c);let J=Atomics.load(s,0);c=pn(J),e.postMessage({id:Z,dataBuffer:c}),yield}let w=Atomics.load(s,0);return(0,dn.decode)(c.slice(0,w))}get result(){if(i(this,Oe))throw i(this,Oe);if(i(this,me))return i(this,Me);throw new Error("Not ready.")}syncify(){return this.scheduleSync(),this.syncifier.syncifyTask(this),this.result}};Re=new WeakMap,me=new WeakMap,Me=new WeakMap,Oe=new WeakMap,ge=new WeakMap;var br=class{constructor(){this.nextTaskId=new Int32Array([1]),this.signalBuffer=new Int32Array(new SharedArrayBuffer(32*4+4)),this.tasks=new Map}scheduleTask(e){e.taskId=this.nextTaskId[0],this.nextTaskId[0]+=2,e.signalBuffer=this.signalBuffer,this.tasks.set(e.taskId,e)}waitOnSignalBuffer(){for(;;)switch(Atomics.wait(this.signalBuffer,0,0,50)){case"ok":case"not-equal":return;case"timed-out":wr[0]!==0&&hn();break;default:throw new Error("Unreachable")}}*tasksIdsToWakeup(){let e=Atomics.load(this.signalBuffer,0);for(let t=0;t<32;t++){let n=1<<t;e&n&&(Atomics.and(this.signalBuffer,0,~n),yield Atomics.exchange(this.signalBuffer,t+1,0))}}pollTasks(e){let t=!1;for(let n of this.tasksIdsToWakeup()){let s=this.tasks.get(n);if(!s)throw new Error(`Assertion error: unknown taskId ${n}.`);s.poll()&&(this.tasks.delete(n),s===e&&(t=!0))}return t}syncifyTask(e){for(;;)if(this.waitOnSignalBuffer(),this.pollTasks(e))return}},Pt=[];function pn(r){let e=Math.ceil(Math.log2(r));Pt[e]||(Pt[e]=[]);let t=Pt[e].pop();return t?(t.fill(0),t):new Uint8Array(new SharedArrayBuffer(2**e))}function Cs(r){let e=Math.ceil(Math.log2(r.byteLength));Pt[e].push(r)}var wr=new Int32Array(new ArrayBuffer(4)),hn=()=>{throw wr[0]=0,new Error("Interrupted!")};function yn(r){hn=r}function fn(r){wr=new Int32Array(r)}var l={};function Rn(r){Object.keys(r).forEach(e=>l._free(r[e]))}x&&(globalThis.Worker=H("worker_threads").Worker);var be,St,mn,Ue,Ie=class extends fe{constructor(t){super();u(this,St);u(this,be,void 0);this.close=()=>{};u(this,Ue,async(t,n)=>{if(!(!n||!n.type))switch(n.type){case"resolve":h(this,be,new Int32Array(n.data)),this.resolve();return;case"response":this.resolveResponse(n);return;case"system":this.systemQueue.put(n.data);return;default:this.outputQueue.put(n);return;case"sync-request":{let s=n,o=s.data.msg,a=s.data.reqData;switch(o.type){case"read":{let c=await this.inputQueue.get();await an(t,a,c);break}default:throw new D(`Unsupported request type '${o.type}'.`)}return}case"request":throw new D("Can't send messages of type 'request' from a worker. Please Use 'sync-request' instead.")}});let n=s=>{v(this,St,mn).call(this,s),this.close=()=>{s.terminate(),this.putClosedMessage()};let o={type:"init",data:{config:t,channelType:V.SharedArrayBuffer}};s.postMessage(o)};if(ce(t.baseUrl))nt(`${t.baseUrl}webr-worker.js`,s=>n(s));else{let s=new Worker(`${t.baseUrl}webr-worker.js`);n(s)}({resolve:this.resolve,promise:this.initialised}=le())}interrupt(){if(!i(this,be))throw new D("Failed attempt to interrupt before initialising interruptBuffer");this.inputQueue.reset(),i(this,be)[0]=1}};be=new WeakMap,St=new WeakSet,mn=function(t){x?t.on("message",n=>{i(this,Ue).call(this,t,n)}):t.onmessage=n=>i(this,Ue).call(this,t,n.data)},Ue=new WeakMap;var te,Ce,re,je,xr=class{constructor(){u(this,te,void 0);u(this,Ce,()=>0);u(this,re,new Int32Array(new SharedArrayBuffer(4)));u(this,je,()=>{});h(this,te,x?H("worker_threads").parentPort:globalThis),fn(i(this,re).buffer),yn(()=>this.handleInterrupt())}resolve(){this.write({type:"resolve",data:i(this,re).buffer})}write(e,t){i(this,te).postMessage(e,t)}writeSystem(e,t){i(this,te).postMessage({type:"system",data:e},t)}read(){let e={type:"read"};return new _t(i(this,te),e).syncify()}inputOrDispatch(){for(;;){let e=this.read();if(e.type==="stdin")return l.allocateUTF8(e.data);i(this,Ce).call(this,e)}}run(e){l.callMain(e)}setInterrupt(e){h(this,je,e)}handleInterrupt(){i(this,re)[0]!==0&&(i(this,re)[0]=0,i(this,je).call(this))}setDispatchHandler(e){h(this,Ce,e)}};te=new WeakMap,Ce=new WeakMap,re=new WeakMap,je=new WeakMap;var At=Y(wt());x&&(globalThis.Worker=H("worker_threads").Worker);var we,ne,xe,kt,gn,Dt,bn,Wt,wn,Be,Ne=class extends fe{constructor(t){super();u(this,kt);u(this,Dt);u(this,Wt);this.close=()=>{};u(this,we,new Map);u(this,ne,void 0);u(this,xe,!1);u(this,Be,async(t,n)=>{if(!(!n||!n.type))switch(n.type){case"resolve":this.resolve();return;case"response":this.resolveResponse(n);return;case"system":this.systemQueue.put(n.data);return;default:this.outputQueue.put(n);return;case"sync-request":{let s=n.data;i(this,we).set(s.data.uuid,s.data.msg);return}case"request":throw new D("Can't send messages of type 'request' from a worker.Use service worker fetch request instead.")}});let n=s=>{v(this,Wt,wn).call(this,s),this.close=()=>{s.terminate(),this.putClosedMessage()},v(this,kt,gn).call(this,`${t.serviceWorkerUrl}webr-serviceworker.js`).then(o=>{let a={type:"init",data:{config:t,channelType:V.ServiceWorker,clientId:o,location:window.location.href}};s.postMessage(a)})};if(ce(t.serviceWorkerUrl))nt(`${t.serviceWorkerUrl}webr-worker.js`,s=>n(s));else{let s=new Worker(`${t.serviceWorkerUrl}webr-worker.js`);n(s)}({resolve:this.resolve,promise:this.initialised}=le())}activeRegistration(){var t;if(!((t=i(this,ne))!=null&&t.active))throw new D("Attempted to obtain a non-existent active registration.");return i(this,ne).active}interrupt(){h(this,xe,!0)}};we=new WeakMap,ne=new WeakMap,xe=new WeakMap,kt=new WeakSet,gn=async function(t){h(this,ne,await navigator.serviceWorker.register(t)),await navigator.serviceWorker.ready,window.addEventListener("beforeunload",()=>{var s;(s=i(this,ne))==null||s.unregister()});let n=await new Promise(s=>{navigator.serviceWorker.addEventListener("message",function o(a){a.data.type==="registration-successful"&&(navigator.serviceWorker.removeEventListener("message",o),s(a.data.clientId))}),this.activeRegistration().postMessage({type:"register-client-main"})});return navigator.serviceWorker.addEventListener("message",s=>{v(this,Dt,bn).call(this,s)}),n},Dt=new WeakSet,bn=async function(t){if(t.data.type==="request"){let n=t.data.data,s=i(this,we).get(n);if(!s)throw new D("Request not found during service worker XHR request");switch(i(this,we).delete(n),s.type){case"read":{let o=await this.inputQueue.get();this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:n,response:gr(n,o)});break}case"interrupt":{let o=i(this,xe);this.activeRegistration().postMessage({type:"wasm-webr-fetch-response",uuid:n,response:gr(n,o)}),this.inputQueue.reset(),h(this,xe,!1);break}default:throw new D(`Unsupported request type '${s.type}'.`)}return}},Wt=new WeakSet,wn=function(t){x?t.on("message",n=>{i(this,Be).call(this,t,n)}):t.onmessage=n=>i(this,Be).call(this,t,n.data)},Be=new WeakMap;var Ee,Le,Fe,qe,Ve,Je,Er=class{constructor(e){u(this,Ee,void 0);u(this,Le,void 0);u(this,Fe,void 0);u(this,qe,Date.now());u(this,Ve,()=>0);u(this,Je,()=>{});this.onMessageFromMainThread=()=>{};if(!e.clientId||!e.location)throw new D("Can't start service worker channel");h(this,Le,e.clientId),h(this,Fe,e.location),h(this,Ee,x?H("worker_threads").parentPort:globalThis)}resolve(){this.write({type:"resolve"})}write(e,t){i(this,Ee).postMessage(e,t)}writeSystem(e,t){i(this,Ee).postMessage({type:"system",data:e},t)}syncRequest(e){let t=vt(e);this.write({type:"sync-request",data:t});let n=0;for(;;)try{let s=new URL("__wasm__/webr-fetch-request/",i(this,Fe)),o=new XMLHttpRequest;o.timeout=6e4,o.responseType="arraybuffer",o.open("POST",s,!1);let a={clientId:i(this,Le),uuid:t.data.uuid};return o.send((0,At.encode)(a)),(0,At.decode)(o.response)}catch(s){if(s instanceof DOMException&&n++<1e3)console.log("Service worker request failed - resending request");else throw s}}read(){return this.syncRequest({type:"read"}).data.resp}inputOrDispatch(){for(;;){let e=this.read();if(e.type==="stdin")return l.allocateUTF8(e.data);i(this,Ve).call(this,e)}}run(e){l.callMain(e)}setInterrupt(e){h(this,Je,e)}handleInterrupt(){Date.now()>i(this,qe)+1e3&&(h(this,qe,Date.now()),this.syncRequest({type:"interrupt"}).data.resp&&i(this,Je).call(this))}setDispatchHandler(e){h(this,Ve,e)}};Ee=new WeakMap,Le=new WeakMap,Fe=new WeakMap,qe=new WeakMap,Ve=new WeakMap,Je=new WeakMap;var V={Automatic:0,SharedArrayBuffer:1,ServiceWorker:2};function xn(r){switch(r.channelType){case V.SharedArrayBuffer:return new Ie(r);case V.ServiceWorker:return new Ne(r);case V.Automatic:default:if(typeof SharedArrayBuffer<"u")return new Ie(r);if("serviceWorker"in navigator&&!ce(r.serviceWorkerUrl))return new Ne(r);throw new D("Can't initialise main thread communication channel")}}var En=x?__dirname+"/":"https://webr.r-wasm.org/v0.2.0/",vn="https://repo.r-wasm.org";function g(r){return r&&(typeof r=="object"||typeof r=="function")&&"payloadType"in r&&Tt(r._payload)}function ki(r){return g(r)&&r._payload.obj.type==="null"}function Di(r){return g(r)&&r._payload.obj.type==="symbol"}function Wi(r){return g(r)&&r._payload.obj.type==="pairlist"}function Ai(r){return g(r)&&r._payload.obj.type==="environment"}function Mi(r){return g(r)&&r._payload.obj.type==="logical"}function Oi(r){return g(r)&&r._payload.obj.type==="integer"}function Ii(r){return g(r)&&r._payload.obj.type==="double"}function Ui(r){return g(r)&&r._payload.obj.type==="complex"}function Ci(r){return g(r)&&r._payload.obj.type==="character"}function ji(r){return g(r)&&r._payload.obj.type==="list"}function Ni(r){return g(r)&&r._payload.obj.type==="raw"}function Bi(r){return g(r)&&r._payload.obj.type==="call"}function Tn(r){var e;return!!(g(r)&&((e=r._payload.obj.methods)!=null&&e.includes("exec")))}var f={null:0,symbol:1,pairlist:2,closure:3,environment:4,promise:5,call:6,special:7,builtin:8,string:9,logical:10,integer:13,double:14,complex:15,character:16,dots:17,any:18,list:19,expression:20,bytecode:21,pointer:22,weakref:23,raw:24,s4:25,new:30,free:31,function:99};function vr(r){return r&&typeof r=="object"&&Object.keys(f).includes(r.type)}function Tr(r){return r&&typeof r=="object"&&"re"in r&&"im"in r}function Mt(r){return l._Rf_protect(L(r)),r}function S(r,e){return l._Rf_protect(L(r)),++e.n,r}function Pn(r){let e=l._malloc(4);return l._R_ProtectWithIndex(L(r),e),{loc:l.getValue(e,"i32"),ptr:e}}function _n(r){l._Rf_unprotect(1),l._free(r.ptr)}function Sn(r,e){return l._R_Reprotect(L(r),e.loc),r}function W(r){l._Rf_unprotect(r)}function Pr(r,e,t){l._Rf_defineVar(L(e),L(t),L(r))}function kn(r,e){let t={},n={n:0};try{let s=new ze(e);S(s,n),t.code=l.allocateUTF8(r);let o=l._R_ParseEvalString(t.code,s.ptr);return y.wrap(o)}finally{Rn(t),W(n.n)}}function He(r,e){return l.getWasmTableEntry(l.GOT.ffi_safe_eval.value)(L(r),L(e))}function L(r){return Ls(r)?r.ptr:r}function ae(r,e){if(l._TYPEOF(r.ptr)!==f[e])throw new Error(`Unexpected object type "${r.type()}" when expecting type "${e}"`)}function Ns(r){if(vr(r))return new(Dn(f[r.type]))(r);if(r&&typeof r=="object"&&"type"in r&&r.type==="null")return new Ct;if(r===null)return new oe({type:"logical",names:null,values:[null]});if(typeof r=="boolean")return new oe(r);if(typeof r=="number")return new Xe(r);if(typeof r=="string")return new G(r);if(Tr(r))return new Ge(r);if(Array.isArray(r))return Bs(r);throw new Error("Robj construction for this JS object is not yet supported")}function Bs(r){let e={n:0};try{let t=new ie([new $("c"),...r]);return S(t,e),t.eval()}finally{W(e.n)}}var E=class{constructor(e){this.ptr=e}type(){let e=l._TYPEOF(this.ptr);return Object.keys(f).find(n=>f[n]===e)}},Te,Ot,se=class extends E{constructor(t){if(!(t instanceof E))return Ns(t);super(t.ptr);u(this,Te)}static wrap(t){let n=l._TYPEOF(t);return new(Dn(n))(new E(t))}get[Symbol.toStringTag](){return`RObject:${this.type()}`}static getPersistentObject(t){return k[t]}getPropertyValue(t){return this[t]}inspect(){kn(".Internal(inspect(x))",{x:this})}isNull(){return l._TYPEOF(this.ptr)===f.null}isUnbound(){return this.ptr===k.unboundValue.ptr}attrs(){return Pe.wrap(l._ATTRIB(this.ptr))}setNames(t){let n;if(t===null)n=k.null;else if(Array.isArray(t)&&t.every(s=>typeof s=="string"||s===null))n=new G(t);else throw new Error("Argument to setNames must be null or an Array of strings or null");return l._Rf_setAttrib(this.ptr,k.namesSymbol.ptr,n.ptr),this}names(){let t=G.wrap(l._Rf_getAttrib(this.ptr,k.namesSymbol.ptr));return t.isNull()?null:t.toArray()}includes(t){let n=this.names();return n&&n.includes(t)}toJs(t={depth:0},n=1){throw new Error("This R object cannot be converted to JS")}subset(t){return v(this,Te,Ot).call(this,t,k.bracketSymbol.ptr)}get(t){return v(this,Te,Ot).call(this,t,k.bracket2Symbol.ptr)}getDollar(t){return v(this,Te,Ot).call(this,t,k.dollarSymbol.ptr)}pluck(...t){let n=Pn(k.null);try{let s=(a,c)=>{let p=a.get(c);return Sn(p,n)},o=t.reduce(s,this);return o.isNull()?void 0:o}finally{_n(n)}}set(t,n){let s={n:0};try{let o=new se(t);S(o,s);let a=new se(n);S(a,s);let c=new $("[[<-"),p=l._Rf_lang4(c.ptr,this.ptr,o.ptr,a.ptr);return S(p,s),se.wrap(He(p,k.baseEnv))}finally{W(s.n)}}static getMethods(t){let n=new Set,s=t;do Object.getOwnPropertyNames(s).map(o=>n.add(o));while(s=Object.getPrototypeOf(s));return[...n.keys()].filter(o=>typeof t[o]=="function")}},y=se;Te=new WeakSet,Ot=function(t,n){let s={n:0};try{let o=new se(t);S(o,s);let a=l._Rf_lang3(n,this.ptr,o.ptr);return S(a,s),se.wrap(He(a,k.baseEnv))}finally{W(s.n)}};var Ct=class extends y{constructor(){return super(new E(l.getValue(l._R_NilValue,"*"))),this}toJs(){return{type:"null"}}},$=class extends y{constructor(e){if(e instanceof E){ae(e,"symbol"),super(e);return}let t=l.allocateUTF8(e);try{super(new E(l._Rf_install(t)))}finally{l._free(t)}}toJs(){let e=this.toObject();return{type:"symbol",printname:e.printname,symvalue:e.symvalue,internal:e.internal}}toObject(){return{printname:this.printname().isUnbound()?null:this.printname().toString(),symvalue:this.symvalue().isUnbound()?null:this.symvalue().ptr,internal:this.internal().isNull()?null:this.internal().ptr}}toString(){return this.printname().toString()}printname(){return $e.wrap(l._PRINTNAME(this.ptr))}symvalue(){return y.wrap(l._SYMVALUE(this.ptr))}internal(){return y.wrap(l._INTERNAL(this.ptr))}},Pe=class extends y{constructor(e){if(e instanceof E)return ae(e,"pairlist"),super(e),this;let t={n:0};try{let{names:n,values:s}=Ke(e),o=Pe.wrap(l._Rf_allocList(s.length));S(o,t);for(let[a,c]=[0,o];!c.isNull();[a,c]=[a+1,c.cdr()])c.setcar(new y(s[a]));o.setNames(n),super(o)}finally{W(t.n)}}get length(){return this.toArray().length}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:n=1}={}){let s=this.entries({depth:n}),o=s.map(([a,c])=>a);if(!e&&new Set(o).size!==o.length)throw new Error("Duplicate key when converting pairlist without allowDuplicateKey enabled");if(!t&&o.some(a=>!a))throw new Error("Empty or null key when converting pairlist without allowEmptyKey enabled");return Object.fromEntries(s.filter((a,c)=>s.findIndex(p=>p[0]===a[0])===c))}entries(e={depth:1}){let t=this.toJs(e);return t.values.map((n,s)=>[t.names?t.names[s]:null,n])}toJs(e={depth:0},t=1){let n=[],s=!1,o=[];for(let c=this;!c.isNull();c=c.cdr()){let p=c.tag();p.isNull()?n.push(""):(s=!0,n.push(p.toString())),e.depth&&t>=e.depth?o.push(c.car()):o.push(c.car().toJs(e,t+1))}return{type:"pairlist",names:s?n:null,values:o}}includes(e){return e in this.toObject()}setcar(e){l._SETCAR(this.ptr,e.ptr)}car(){return y.wrap(l._CAR(this.ptr))}cdr(){return y.wrap(l._CDR(this.ptr))}tag(){return y.wrap(l._TAG(this.ptr))}},ie=class extends y{constructor(e){if(e instanceof E)return ae(e,"call"),super(e),this;let t={n:0};try{let{values:n}=Ke(e),s=n.map(a=>S(new y(a),t)),o=ie.wrap(l._Rf_allocVector(f.call,n.length));S(o,t);for(let[a,c]=[0,o];!c.isNull();[a,c]=[a+1,c.cdr()])c.setcar(s[a]);super(o)}finally{W(t.n)}}setcar(e){l._SETCAR(this.ptr,e.ptr)}car(){return y.wrap(l._CAR(this.ptr))}cdr(){return y.wrap(l._CDR(this.ptr))}eval(){return y.wrap(He(this.ptr,k.baseEnv))}},_r=class extends y{constructor(e){if(e instanceof E)return ae(e,"list"),super(e),this;let t={n:0};try{let{names:n,values:s}=Ke(e),o=l._Rf_allocVector(f.list,s.length);S(o,t),s.forEach((a,c)=>{l._SET_VECTOR_ELT(o,c,new y(a).ptr)}),y.wrap(o).setNames(n),super(new E(o))}finally{W(t.n)}}get length(){return l._LENGTH(this.ptr)}toArray(e={depth:1}){return this.toJs(e).values}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1,depth:n=1}={}){let s=this.entries({depth:n}),o=s.map(([a,c])=>a);if(!e&&new Set(o).size!==o.length)throw new Error("Duplicate key when converting list without allowDuplicateKey enabled");if(!t&&o.some(a=>!a))throw new Error("Empty or null key when converting list without allowEmptyKey enabled");return Object.fromEntries(s.filter((a,c)=>s.findIndex(p=>p[0]===a[0])===c))}entries(e={depth:1}){let t=this.toJs(e);return t.values.map((n,s)=>[t.names?t.names[s]:null,n])}toJs(e={depth:0},t=1){return{type:"list",names:this.names(),values:[...Array(this.length).keys()].map(n=>e.depth&&t>=e.depth?this.get(n+1):this.get(n+1).toJs(e,t+1))}}},ve=class extends y{exec(...e){let t={n:0};try{let n=new ie([this,...e]);return S(n,t),n.eval()}finally{W(t.n)}}},$e=class extends y{constructor(e){if(e instanceof E){ae(e,"string"),super(e);return}let t=l.allocateUTF8(e);try{super(new E(l._Rf_mkChar(t)))}finally{l._free(t)}}toString(){return l.UTF8ToString(l._R_CHAR(this.ptr))}toJs(){return{type:"string",value:this.toString()}}},ze=class extends y{constructor(e={}){if(e instanceof E)return ae(e,"environment"),super(e),this;let t=0;try{let{names:n,values:s}=Ke(e),o=Mt(l._R_NewEnv(k.globalEnv.ptr,0,0));++t,s.forEach((a,c)=>{let p=n?n[c]:null;if(!p)throw new Error("Can't create object in new environment with empty symbol name");let w=new $(p),Z=Mt(new y(a));try{Pr(o,w,Z)}finally{W(1)}}),super(new E(o))}finally{W(t)}}ls(e=!1,t=!0){return G.wrap(l._R_lsInternal3(this.ptr,Number(e),Number(t))).toArray()}bind(e,t){let n=new $(e),s=Mt(new y(t));try{Pr(this,n,s)}finally{W(1)}}names(){return this.ls(!0,!0)}frame(){return y.wrap(l._FRAME(this.ptr))}subset(e){if(typeof e=="number")throw new Error("Object of type environment is not subsettable");return this.getDollar(e)}toObject({depth:e=0}={}){let t=this.names();return Object.fromEntries([...Array(t.length).keys()].map(n=>[t[n],this.getDollar(t[n]).toJs({depth:e})]))}toJs(e={depth:0},t=1){let n=this.names(),s=[...Array(n.length).keys()].map(o=>e.depth&&t>=e.depth?this.getDollar(n[o]):this.getDollar(n[o]).toJs(e,t+1));return{type:"environment",names:n,values:s}}},K=class extends y{constructor(e,t,n){if(e instanceof E)return ae(e,t),super(e),this;let s={n:0};try{let{names:o,values:a}=Ke(e),c=l._Rf_allocVector(f[t],a.length);S(c,s),a.forEach(n(c)),y.wrap(c).setNames(o),super(new E(c))}finally{W(s.n)}}get length(){return l._LENGTH(this.ptr)}get(e){return super.get(e)}subset(e){return super.subset(e)}getDollar(e){throw new Error("$ operator is invalid for atomic vectors")}detectMissing(){let e={n:0};try{let t=l._Rf_lang2(new $("is.na").ptr,this.ptr);S(t,e);let n=oe.wrap(He(t,k.baseEnv));S(n,e);let s=n.toTypedArray();return Array.from(s).map(o=>!!o)}finally{W(e.n)}}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,n)=>t?null:e[n])}toObject({allowDuplicateKey:e=!0,allowEmptyKey:t=!1}={}){let n=this.entries(),s=n.map(([o,a])=>o);if(!e&&new Set(s).size!==s.length)throw new Error("Duplicate key when converting atomic vector without allowDuplicateKey enabled");if(!t&&s.some(o=>!o))throw new Error("Empty or null key when converting atomic vector without allowEmptyKey enabled");return Object.fromEntries(n.filter((o,a)=>n.findIndex(c=>c[0]===o[0])===a))}entries(){let e=this.toArray(),t=this.names();return e.map((n,s)=>[t?t[s]:null,n])}toJs(){return{type:this.type(),names:this.names(),values:this.toArray()}}},jt,Sr=class extends K{constructor(e){super(e,"logical",i(Sr,jt))}getBoolean(e){return this.get(e).toArray()[0]}toBoolean(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getBoolean(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS boolean");return e}toTypedArray(){return new Int32Array(l.HEAP32.subarray(l._LOGICAL(this.ptr)/4,l._LOGICAL(this.ptr)/4+this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,n)=>t?null:!!e[n])}},oe=Sr;jt=new WeakMap,u(oe,jt,e=>{let t=l._LOGICAL(e),n=l.getValue(l._R_NaInt,"i32");return(s,o)=>{l.setValue(t+4*o,s===null?n:!!s,"i32")}});var Nt,kr=class extends K{constructor(e){super(e,"integer",i(kr,Nt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Int32Array(l.HEAP32.subarray(l._INTEGER(this.ptr)/4,l._INTEGER(this.ptr)/4+this.length))}},It=kr;Nt=new WeakMap,u(It,Nt,e=>{let t=l._INTEGER(e),n=l.getValue(l._R_NaInt,"i32");return(s,o)=>{l.setValue(t+4*o,s===null?n:Math.round(Number(s)),"i32")}});var Bt,Dr=class extends K{constructor(e){super(e,"double",i(Dr,Bt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Float64Array(l.HEAPF64.subarray(l._REAL(this.ptr)/8,l._REAL(this.ptr)/8+this.length))}},Xe=Dr;Bt=new WeakMap,u(Xe,Bt,e=>{let t=l._REAL(e),n=l.getValue(l._R_NaReal,"double");return(s,o)=>{l.setValue(t+8*o,s===null?n:s,"double")}});var Lt,Wr=class extends K{constructor(e){super(e,"complex",i(Wr,Lt))}getComplex(e){return this.get(e).toArray()[0]}toComplex(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getComplex(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS object");return e}toTypedArray(){return new Float64Array(l.HEAPF64.subarray(l._COMPLEX(this.ptr)/8,l._COMPLEX(this.ptr)/8+2*this.length))}toArray(){let e=this.toTypedArray();return this.detectMissing().map((t,n)=>t?null:{re:e[2*n],im:e[2*n+1]})}},Ge=Wr;Lt=new WeakMap,u(Ge,Lt,e=>{let t=l._COMPLEX(e),n=l.getValue(l._R_NaReal,"double");return(s,o)=>{l.setValue(t+8*(2*o),s===null?n:s.re,"double"),l.setValue(t+8*(2*o+1),s===null?n:s.im,"double")}});var Ft,Ar=class extends K{constructor(e){super(e,"character",i(Ar,Ft))}getString(e){return this.get(e).toArray()[0]}toString(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getString(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS string");return e}toTypedArray(){return new Uint32Array(l.HEAPU32.subarray(l._STRING_PTR(this.ptr)/4,l._STRING_PTR(this.ptr)/4+this.length))}toArray(){return this.detectMissing().map((e,t)=>e?null:l.UTF8ToString(l._R_CHAR(l._STRING_ELT(this.ptr,t))))}},G=Ar;Ft=new WeakMap,u(G,Ft,e=>(t,n)=>{t===null?l._SET_STRING_ELT(e,n,k.naString.ptr):l._SET_STRING_ELT(e,n,new $e(t).ptr)});var qt,Mr=class extends K{constructor(e){super(e,"raw",i(Mr,qt))}getNumber(e){return this.get(e).toArray()[0]}toNumber(){if(this.length!==1)throw new Error("Can't convert atomic vector of length > 1 to a scalar JS value");let e=this.getNumber(1);if(e===null)throw new Error("Can't convert missing value `NA` to a JS number");return e}toTypedArray(){return new Uint8Array(l.HEAPU8.subarray(l._RAW(this.ptr),l._RAW(this.ptr)+this.length))}},Ut=Mr;qt=new WeakMap,u(Ut,qt,e=>{let t=l._RAW(e);return(n,s)=>{l.setValue(t+s,Number(n),"i8")}});function Ke(r){return vr(r)?r:Array.isArray(r)||ArrayBuffer.isView(r)?{names:null,values:r}:r&&typeof r=="object"&&!Tr(r)?{names:Object.keys(r),values:Object.values(r)}:{names:null,values:[r]}}function Dn(r){let e={[f.null]:Ct,[f.symbol]:$,[f.pairlist]:Pe,[f.closure]:ve,[f.environment]:ze,[f.call]:ie,[f.special]:ve,[f.builtin]:ve,[f.string]:$e,[f.logical]:oe,[f.integer]:It,[f.double]:Xe,[f.complex]:Ge,[f.character]:G,[f.list]:_r,[f.raw]:Ut,[f.function]:ve};return r in e?e[r]:y}function Ls(r){return r instanceof y}var k;function qs(){}function Vs(r,e){return async function*(){let t={type:"callRObjectMethod",data:{payload:e._payload,prop:"getPropertyValue",args:[{payloadType:"raw",obj:"length"}],shelter:void 0}},n=await r.request(t);if(typeof n.obj!="number")throw new M("Cannot iterate over object, unexpected type for length property.");for(let s=1;s<=n.obj;s++)yield e.get(s)}}function Wn(r,e,t){return async(...n)=>{let s=n.map(c=>g(c)?c._payload:{obj:I(c,g,p=>p._payload),payloadType:"raw"}),o={type:"callRObjectMethod",data:{payload:t,prop:e,args:s}},a=await r.request(o);switch(a.payloadType){case"ptr":return Q(r,a);case"raw":return I(a,Tt,(p,w)=>Q(w,p),r).obj}}}async function Js(r,e,t,n){let s={type:"newRObject",data:{objType:e,obj:I(n,g,a=>a._payload),shelter:t}},o=await r.request(s);switch(o.payloadType){case"raw":throw new z("Unexpected raw payload type returned from newRObject");case"ptr":return Q(r,o)}}function Q(r,e){var n;let t=new Proxy((n=e.obj.methods)!=null&&n.includes("exec")?Object.assign(qs,{...e}):e,{get:(s,o)=>{var a;if(o==="_payload")return e;if(o===Symbol.asyncIterator)return Vs(r,t);if((a=e.obj.methods)!=null&&a.includes(o.toString()))return Wn(r,o.toString(),e)},apply:async(s,o,a)=>{let c=await Q(r,e).exec(...a);return Tn(c)?c:c.toJs()}});return t}function A(r,e,t){return new Proxy(y,{construct:(n,s)=>Js(r,t,e,...s),get:(n,s)=>Wn(r,s.toString())})}var Qe,Ze,Ye,et,Vt,Jt,Ht,zt,Xt,An,Or=class{constructor(e={},t={REnv:{R_HOME:"/usr/lib/R",FONTCONFIG_PATH:"/etc/fonts",R_ENABLE_JIT:"0"}}){u(this,Xt);u(this,Qe,void 0);u(this,Ze,void 0);u(this,Ye,void 0);u(this,et,void 0);u(this,Vt,e=>{console.log(e)});u(this,Jt,e=>{console.error(e)});u(this,Ht,e=>{let t=prompt(e);t&&this.stdin(`${t}
`)});u(this,zt,e=>{if(x)throw new Error("Plotting with HTML canvas is not yet supported under Node");this.canvas.getContext("2d").drawImage(e,0,0)});this.webR=new Gt(t),x||(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width","1008"),this.canvas.setAttribute("height","1008")),h(this,Qe,e.stdout||i(this,Vt)),h(this,Ze,e.stderr||i(this,Jt)),h(this,Ye,e.prompt||i(this,Ht)),h(this,et,e.canvasImage||i(this,zt)),this.webR.evalRVoid("options(device=webr::canvas)")}stdin(e){this.webR.writeConsole(e)}interrupt(){this.webR.interrupt()}run(){v(this,Xt,An).call(this)}};Qe=new WeakMap,Ze=new WeakMap,Ye=new WeakMap,et=new WeakMap,Vt=new WeakMap,Jt=new WeakMap,Ht=new WeakMap,zt=new WeakMap,Xt=new WeakSet,An=async function(){for(;;){let e=await this.webR.read();switch(e.type){case"stdout":i(this,Qe).call(this,e.data);break;case"stderr":i(this,Ze).call(this,e.data);break;case"prompt":i(this,Ye).call(this,e.data);break;case"canvasImage":i(this,et).call(this,e.data.image);break;case"closed":return;default:console.warn(`Unhandled output type for webR Console: ${e.type}.`)}}};var Hs={FONTCONFIG_PATH:"/etc/fonts",R_HOME:"/usr/lib/R",R_ENABLE_JIT:"0"},Mn={RArgs:[],REnv:Hs,baseUrl:En,serviceWorkerUrl:"",repoUrl:vn,homedir:"/home/web_user",interactive:!0,channelType:V.Automatic,createLazyFilesystem:!0},b,Kt,On,Gt=class{constructor(e={}){u(this,Kt);u(this,b,void 0);this.FS={lookupPath:async e=>{let t={type:"lookupPath",data:{path:e}};return(await i(this,b).request(t)).obj},mkdir:async e=>{let t={type:"mkdir",data:{path:e}};return(await i(this,b).request(t)).obj},readFile:async(e,t)=>{let n={type:"readFile",data:{path:e,flags:t}};return(await i(this,b).request(n)).obj},rmdir:async e=>{let t={type:"rmdir",data:{path:e}};await i(this,b).request(t)},writeFile:async(e,t,n)=>{let s={type:"writeFile",data:{path:e,data:t,flags:n}};await i(this,b).request(s)},unlink:async e=>{let t={type:"unlink",data:{path:e}};await i(this,b).request(t)}};let t={...Mn,...e,REnv:{...Mn.REnv,...e.REnv}};h(this,b,xn(t)),this.objs={},this.Shelter=zs(i(this,b))}async init(){let e=await i(this,b).initialised;return this.globalShelter=await new this.Shelter,this.RObject=this.globalShelter.RObject,this.RLogical=this.globalShelter.RLogical,this.RInteger=this.globalShelter.RInteger,this.RDouble=this.globalShelter.RDouble,this.RComplex=this.globalShelter.RComplex,this.RCharacter=this.globalShelter.RCharacter,this.RRaw=this.globalShelter.RRaw,this.RList=this.globalShelter.RList,this.RPairlist=this.globalShelter.RPairlist,this.REnvironment=this.globalShelter.REnvironment,this.RSymbol=this.globalShelter.RSymbol,this.RString=this.globalShelter.RString,this.RCall=this.globalShelter.RCall,this.objs={baseEnv:await this.RObject.getPersistentObject("baseEnv"),globalEnv:await this.RObject.getPersistentObject("globalEnv"),null:await this.RObject.getPersistentObject("null"),true:await this.RObject.getPersistentObject("true"),false:await this.RObject.getPersistentObject("false"),na:await this.RObject.getPersistentObject("na")},v(this,Kt,On).call(this),e}close(){i(this,b).close()}async read(){return await i(this,b).read()}async flush(){return await i(this,b).flush()}write(e){i(this,b).write(e)}writeConsole(e){this.write({type:"stdin",data:e+`
`})}interrupt(){i(this,b).interrupt()}async installPackages(e,t=!1){for(let n of e){let s={type:"installPackage",data:{name:n,quiet:t}};await i(this,b).request(s)}}async destroy(e){await this.globalShelter.destroy(e)}async evalR(e,t){return this.globalShelter.evalR(e,t)}async evalRVoid(e,t){return this.evalRRaw(e,"void",t)}async evalRBoolean(e,t){return this.evalRRaw(e,"boolean",t)}async evalRNumber(e,t){return this.evalRRaw(e,"number",t)}async evalRString(e,t){return this.evalRRaw(e,"string",t)}async evalRRaw(e,t,n={}){let s=I(n,g,c=>c._payload),o={type:"evalRRaw",data:{code:e,options:s,outputType:t}},a=await i(this,b).request(o);switch(a.payloadType){case"raw":return a.obj;case"ptr":throw new z("Unexpected ptr payload type returned from evalRVoid")}}async invokeWasmFunction(e,...t){let n={type:"invokeWasmFunction",data:{ptr:e,args:t}};return(await i(this,b).request(n)).obj}};b=new WeakMap,Kt=new WeakSet,On=async function(){for(;;){let e=await i(this,b).readSystem();switch(e.type){case"setTimeoutWasm":setTimeout((t,n)=>{this.invokeWasmFunction(t,...n)},e.data.delay,e.data.ptr,e.data.args);break;case"console.log":console.log(e.data);break;case"console.warn":console.warn(e.data);break;case"console.error":console.error(e.data);break;default:throw new M("Unknown system message type `"+e.type+"`")}}};var m,R,tt,$t=class{constructor(e){u(this,m,"");u(this,R,void 0);u(this,tt,!1);h(this,R,e)}async init(){if(i(this,tt))return;let e={type:"newShelter"},t=await i(this,R).request(e);h(this,m,t.obj),this.RObject=A(i(this,R),i(this,m),"object"),this.RLogical=A(i(this,R),i(this,m),"logical"),this.RInteger=A(i(this,R),i(this,m),"integer"),this.RDouble=A(i(this,R),i(this,m),"double"),this.RComplex=A(i(this,R),i(this,m),"complex"),this.RCharacter=A(i(this,R),i(this,m),"character"),this.RRaw=A(i(this,R),i(this,m),"raw"),this.RList=A(i(this,R),i(this,m),"list"),this.RPairlist=A(i(this,R),i(this,m),"pairlist"),this.REnvironment=A(i(this,R),i(this,m),"environment"),this.RSymbol=A(i(this,R),i(this,m),"symbol"),this.RString=A(i(this,R),i(this,m),"string"),this.RCall=A(i(this,R),i(this,m),"call"),h(this,tt,!0)}async purge(){let e={type:"shelterPurge",data:i(this,m)};await i(this,R).request(e)}async destroy(e){let t={type:"shelterDestroy",data:{id:i(this,m),obj:e._payload}};await i(this,R).request(t)}async size(){let e={type:"shelterSize",data:i(this,m)};return(await i(this,R).request(e)).obj}async evalR(e,t={}){let n=I(t,g,a=>a._payload),s={type:"evalR",data:{code:e,options:n,shelter:i(this,m)}},o=await i(this,R).request(s);switch(o.payloadType){case"raw":throw new z("Unexpected payload type returned from evalR");default:return Q(i(this,R),o)}}async captureR(e,t={}){let n=I(t,g,a=>a._payload),s={type:"captureR",data:{code:e,options:n,shelter:i(this,m)}},o=await i(this,R).request(s);switch(o.payloadType){case"ptr":throw new z("Unexpected payload type returned from evalR");case"raw":{let a=o.obj,c=Q(i(this,R),a.result),p=a.output;for(let w=0;w<p.length;++w)p[w].type!=="stdout"&&p[w].type!=="stderr"&&(p[w].data=Q(i(this,R),p[w].data));return{result:c,output:p}}}}};m=new WeakMap,R=new WeakMap,tt=new WeakMap;function zs(r){return new Proxy($t,{construct:async()=>{let e=new $t(r);return await e.init(),e}})}export{Or as Console,$t as Shelter,Gt as WebR,D as WebRChannelError,M as WebRError,z as WebRPayloadError,rt as WebRWorkerError,Bi as isRCall,Ci as isRCharacter,Ui as isRComplex,Ii as isRDouble,Ai as isREnvironment,Tn as isRFunction,Oi as isRInteger,ji as isRList,Mi as isRLogical,ki as isRNull,g as isRObject,Wi as isRPairlist,Ni as isRRaw,Di as isRSymbol};
//# sourceMappingURL=webr.mjs.map
