import e from"classnames";import t from"prop-types";import a,{useRef as n,useEffect as l,useReducer as r}from"react";function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==a)return;var n,l,r=[],d=!0,i=!1;try{for(a=a.call(e);!(d=(n=a.next()).done)&&(r.push(n.value),!t||r.length!==t);d=!0);}catch(e){i=!0,l=e}finally{try{d||null==a.return||a.return()}finally{if(i)throw l}}return r}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){if(e){if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function f(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=o(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,l=function(){};return{s:l,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,d=!0,i=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return d=e.done,e},e:function(e){i=!0,r=e},f:function(){try{d||null==a.return||a.return()}finally{if(i)throw r}}}}function h(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a}var p=function(){},v=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){var a,n=f(t);try{for(n.s();!(a=n.n()).done;){var l=a.value;if(l&&l(e),e.defaultPrevented)break}}catch(e){n.e(e)}finally{n.f()}}},b=function(e,t){var a,n=new Set,l=f(e);try{for(l.s();!(a=l.n()).done;){var r=a.value;t.has(r)||n.add(r)}}catch(e){l.e(e)}finally{l.f()}return n},S=function(e,t){return new Set([].concat(c(b(e,t)),c(b(t,e))))},I=function(e){var t=n();return l((function(){t.current=e}),[e]),t.current},y=function(e,t){var a;return!!(null===(a=F(e,t).children)||void 0===a?void 0:a.length)},g=function(e,t){return F(e,t).parent},m=function(e,t,a){for(var n=t,l=[];;){var r=g(e,n);if(0===r||null==r||null!=r&&a.has(r))break;l.push(r),n=r}return l},w=function(e,t,a){var n=[];return function e(t,l){var r=F(t,l);if(null!=r.children){var d,i=f(r.children.filter((function(e){return!a.has(e)})));try{for(i.s();!(d=i.n()).done;){var s=d.value;n.push(s),e(t,s)}}catch(e){i.e(e)}finally{i.f()}}}(e,t),n},E=function(e,t){var a=F(e,t);return null==a.children?[]:a.children},A=function(e,t,a){var n=g(e,t);if(null!=n){var l=F(e,n),r=l.children.indexOf(t)+a;if(l.children[r])return l.children[r]}return null},O=function(e,t,a){var n=F(e,t);for(_(e).id===t&&(n=F(e,F(e,t).children[F(e,t).children.length-1]));a.has(n.id)&&y(e,n.id);)n=F(e,n.children[n.children.length-1]);return n.id},W=function(e,t,a){if(t===_(e).children[0])return null;var n=A(e,t,-1);return null==n?g(e,t):O(e,n,a)},x=function(e,t,a){var n=F(e,t).id;if(y(e,n)&&a.has(n))return F(e,n).children[0];for(;;){var l=A(e,n,1);if(null!=l)return l;if(null==(n=g(e,n)))return null}},T=function(e){var t=e.data,a=e.expandedIds,n=e.from,l=e.to,r=[],d=t.length,i=0,s=n;if(r.push(n),n<l)for(;i<d&&(null!=(s=x(t,s,a))&&r.push(s),null!=s&&s!==l);)i+=1;else if(n>l)for(;i<d&&(null!=(s=W(t,s,a))&&r.push(s),null!=s&&s!==l);)i+=1;return r},j=function(e){var t=0,a=[];return function e(n,l){var r,d={id:n.id||t,name:n.name,children:[],parent:l,metadata:n.metadata?Object.assign({},n.metadata):void 0};if(a.find((function(e){return e.id===d.id})))throw Error("Multiple TreeView nodes have the same ID (".concat(d.id,"). IDs must be unique."));if(a.push(d),t+=1,null===(r=n.children)||void 0===r?void 0:r.length){var i,s=f(n.children);try{for(s.s();!(i=s.n()).done;){e(i.value,d.id)}}catch(e){s.e(e)}finally{s.f()}var c,o=f(a.values());try{for(o.s();!(c=o.n()).done;){var u=c.value;u.parent===d.id&&d.children.push(u.id)}}catch(e){o.e(e)}finally{o.f()}}}(e,null),a},N=function(e){var t=e.isSelected,a=e.isDisabled,n=e.multiSelect;return a||n?t:!!t||void 0},D=function(e){var t=e.isSelected,a=e.isDisabled,n=e.isHalfSelected,l=e.multiSelect;return a?t:n?"mixed":l?t:!!t||void 0},C=function(e,t,a){return t.concat.apply(t,c(t.filter((function(t){return y(e,t)})).map((function(t){return w(e,t,a)}))))},U=function(e,t,a){null!=t?window.navigator.userAgent.match(/Trident/)?setTimeout((function(){return!t.contains(document.activeElement)&&a()}),0):!t.contains(e.nativeEvent.relatedTarget)&&a():console.warn("ref not set on <ul>")},M=function(e,t,a){return y(e,t)&&a.has(t)&&w(e,t,new Set).some((function(e){return a.has(e)}))},k=function(e,t,a){var n=E(e,t);return y(e,t)&&!a.has(t)&&1===n.length&&n.every((function(e){return a.has(e)}))},L=function(e,t,a){var n=E(e,t);return y(e,t)&&a.has(t)&&1===n.length&&n.every((function(e){return a.has(e)}))},_=function(e){var t=e.find((function(e){return null===e.parent}));if(!t)throw Error("TreeView data must contain parent node.");return t},F=function(e,t){var a=e.find((function(e){return e.id===t}));if(null==a)throw Error("Node with id=".concat(t," doesn't exist in the tree."));return a},R=function(e){var t=Array.from(new Set(e));return e.length!==t.length},B="COLLAPSE",z="COLLAPSE_MANY",H="EXPAND",K="EXPAND_MANY",P="HALF_SELECT",G="SELECT",V="DESELECT",Y="TOGGLE",q="TOGGLE_SELECT",X="SELECT_MANY",$="EXCLUSIVE_CHANGE_SELECT_MANY",J="FOCUS",Q="BLUR",Z="DISABLE",ee="ENABLE",te="CLEAR_MANUALLY_TOGGLED",ae="CONTROLLED_SELECT_MANY",ne="UPDATE_TREE_STATE_WHEN_DATA_CHANGED",le=function(e,t){switch(t.type){case B:var a=new Set(e.expandedIds);return a.delete(t.id),Object.assign(Object.assign({},e),{expandedIds:a,tabbableId:t.id,isFocused:!0,lastAction:t.type,lastInteractedWith:t.lastInteractedWith});case z:var n,l=new Set(e.expandedIds),r=f(t.ids);try{for(r.s();!(n=r.n()).done;){var d=n.value;l.delete(d)}}catch(e){r.e(e)}finally{r.f()}return Object.assign(Object.assign({},e),{expandedIds:l,lastAction:t.type,lastInteractedWith:t.lastInteractedWith});case H:var i=new Set(e.expandedIds);return i.add(t.id),Object.assign(Object.assign({},e),{expandedIds:i,tabbableId:t.id,isFocused:!0,lastAction:t.type,lastInteractedWith:t.lastInteractedWith});case K:var s=new Set([].concat(c(e.expandedIds),c(t.ids)));return Object.assign(Object.assign({},e),{expandedIds:s,lastAction:t.type,lastInteractedWith:t.lastInteractedWith});case Y:var o=new Set(e.expandedIds);return e.expandedIds.has(t.id)?o.delete(t.id):o.add(t.id),Object.assign(Object.assign({},e),{expandedIds:o,tabbableId:t.id,isFocused:!0,lastAction:t.type,lastInteractedWith:t.lastInteractedWith});case P:if(e.disabledIds.has(t.id))return e;var u=new Set(e.halfSelectedIds),h=new Set(e.selectedIds);return u.add(t.id),h.delete(t.id),Object.assign(Object.assign({},e),{selectedIds:h,halfSelectedIds:u,tabbableId:t.keepFocus?e.tabbableId:t.id,lastAction:t.type,lastInteractedWith:t.lastInteractedWith,lastManuallyToggled:t.lastManuallyToggled,lastUserSelect:t.NotUserAction?e.lastUserSelect:t.id});case G:if(!t.NotUserAction&&e.disabledIds.has(t.id))return e;var p;t.multiSelect?(p=new Set(e.selectedIds)).add(t.id):(p=new Set).add(t.id);var v=new Set(e.halfSelectedIds);return v.delete(t.id),Object.assign(Object.assign({},e),{selectedIds:p,halfSelectedIds:v,tabbableId:t.keepFocus?e.tabbableId:t.id,isFocused:!0!==t.NotUserAction,lastUserSelect:t.NotUserAction?e.lastUserSelect:t.id,lastAction:t.type,lastInteractedWith:t.lastInteractedWith,lastManuallyToggled:t.lastManuallyToggled});case V:if(!t.NotUserAction&&e.disabledIds.has(t.id))return e;var S,I=new Set(e.selectedIds);return I.delete(t.id),t.multiSelect?(S=new Set(e.halfSelectedIds)).delete(t.id):S=new Set,Object.assign(Object.assign({},e),{selectedIds:I,halfSelectedIds:S,tabbableId:t.keepFocus?e.tabbableId:t.id,isFocused:!0,lastUserSelect:t.NotUserAction?e.lastUserSelect:t.id,lastAction:t.type,lastInteractedWith:t.lastInteractedWith,lastManuallyToggled:t.lastManuallyToggled});case q:if(e.disabledIds.has(t.id))return e;var y,g=e.selectedIds.has(t.id);t.multiSelect?(y=new Set(e.selectedIds),g?y.delete(t.id):y.add(t.id)):(y=new Set,g||y.add(t.id));var m=new Set(e.halfSelectedIds);return m.delete(t.id),Object.assign(Object.assign({},e),{selectedIds:y,halfSelectedIds:m,tabbableId:t.id,isFocused:!0,lastUserSelect:t.NotUserAction?e.lastUserSelect:t.id,lastAction:t.type,lastInteractedWith:t.lastInteractedWith,lastManuallyToggled:t.lastManuallyToggled});case X:var w,E=t.ids.filter((function(t){return!e.disabledIds.has(t)}));if(t.multiSelect){w=t.select?new Set([].concat(c(e.selectedIds),c(E))):b(e.selectedIds,new Set(E));var A=b(e.halfSelectedIds,w);return Object.assign(Object.assign({},e),{selectedIds:w,halfSelectedIds:A,lastAction:t.type,lastInteractedWith:t.lastInteractedWith,lastManuallyToggled:t.lastManuallyToggled})}return e;case $:var O,W=t.ids.filter((function(t){return!e.disabledIds.has(t)}));if(t.multiSelect){O=t.select?new Set(W):b(e.selectedIds,new Set(W));var x=b(e.halfSelectedIds,O);return Object.assign(Object.assign({},e),{selectedIds:O,halfSelectedIds:x,lastAction:t.type,lastInteractedWith:t.lastInteractedWith,lastManuallyToggled:t.lastManuallyToggled})}return e;case ae:var T,j=e.lastInteractedWith,N=e.tabbableId;if(t.multiSelect)T=new Set(t.ids),t.ids.length&&(j=t.ids[t.ids.length-1],N=t.ids[t.ids.length-1]);else{T=new Set,t.ids.length>1&&console.warn("Tree in singleSelect mode, only the first item from selectedIds will be selected.");var D=t.ids[0];D&&T.add(D),j=null!=D?D:j,N=null!=D?D:j}var C=new Set(e.halfSelectedIds);t.ids.every((function(e){return C.delete(e)}));var U=new Set(t.ids);return Object.assign(Object.assign({},e),{selectedIds:T,halfSelectedIds:C,controlledIds:U,isFocused:!0,lastAction:t.type,tabbableId:N,lastInteractedWith:j});case J:return Object.assign(Object.assign({},e),{tabbableId:t.id,isFocused:!0,lastAction:t.type,lastInteractedWith:t.lastInteractedWith});case Q:return Object.assign(Object.assign({},e),{isFocused:!1});case Z:var M=new Set(e.disabledIds);return M.add(t.id),Object.assign(Object.assign({},e),{disabledIds:M});case ee:var k=new Set(e.disabledIds);return k.delete(t.id),Object.assign(Object.assign({},e),{disabledIds:k});case te:return Object.assign(Object.assign({},e),{lastManuallyToggled:null});case ne:return Object.assign(Object.assign({},e),{tabbableId:t.tabbableId,lastInteractedWith:t.lastInteractedWith,lastManuallyToggled:t.lastManuallyToggled,lastUserSelect:t.lastUserSelect});default:throw new Error("Invalid action passed to the reducer")}},re={root:"tree",node:"tree-node",branch:"tree-node__branch",branchWrapper:"tree-branch-wrapper",leafListItem:"tree-leaf-list-item",leaf:"tree-node__leaf",nodeGroup:"tree-node-group"},de={select:"SELECT",focus:"FOCUS",exclusiveSelect:"EXCLUSIVE_SELECT"},ie=Object.freeze(Object.values(de)),se=Object.freeze(Object.values({check:"check",select:"select"})),ce=function(t){var n=t.element,l=t.dispatch,r=t.data,d=t.selectedIds,s=t.tabbableId,o=t.isFocused,u=t.expandedIds,f=t.disabledIds,b=t.halfSelectedIds,S=t.lastUserSelect,I=t.nodeRefs,g=t.leafRefs,m=t.baseClassNames,E=t.nodeRenderer,A=t.nodeAction,O=t.setsize,W=t.posinset,x=t.level,j=t.propagateCollapse,U=t.propagateSelect,k=t.multiSelect,_=t.togglableSelect,F=t.clickAction,R=t.state,B=function(e){if(!(e.ctrlKey||e.altKey||e.shiftKey))if(u.has(n.id)&&j){var t=[n.id].concat(c(w(r,n.id,new Set)));l({type:z,ids:t,lastInteractedWith:n.id})}else l({type:Y,id:n.id,lastInteractedWith:n.id})},H=function(){return l({type:J,id:n.id,lastInteractedWith:n.id})},K=function(e){if(e.shiftKey){var t=T({data:r,expandedIds:u,from:S,to:n.id}).filter((function(e){return!f.has(e)}));t=U?C(r,t,f):t,l({type:$,select:!0,multiSelect:k,ids:t,lastInteractedWith:n.id,lastManuallyToggled:n.id})}else if(e.ctrlKey||F===de.select){var a=M(r,n.id,d),i=L(r,n.id,d);l({type:_?a&&!i?P:q:G,id:n.id,multiSelect:k,lastInteractedWith:n.id,lastManuallyToggled:n.id}),U&&!f.has(n.id)&&l({type:X,ids:C(r,[n.id],f),select:!_||!d.has(n.id),multiSelect:k,lastInteractedWith:n.id,lastManuallyToggled:n.id})}else F===de.exclusiveSelect?l({type:_?q:G,id:n.id,multiSelect:!1,lastInteractedWith:n.id,lastManuallyToggled:n.id}):F===de.focus&&l({type:J,id:n.id,lastInteractedWith:n.id})},V=function(t){var a;return e(t,(i(a={},"".concat(t,"--expanded"),u.has(n.id)),i(a,"".concat(t,"--selected"),d.has(n.id)),i(a,"".concat(t,"--focused"),s===n.id&&o),a))},Q="select"===A?{"aria-selected":N({isSelected:d.has(n.id),isDisabled:f.has(n.id),multiSelect:k})}:{"aria-checked":D({isSelected:d.has(n.id),isDisabled:f.has(n.id),isHalfSelected:b.has(n.id),multiSelect:k})};return y(r,n.id)||n.isBranch?a.createElement("li",Object.assign({role:"treeitem","aria-expanded":u.has(n.id),"aria-setsize":O,"aria-posinset":W,"aria-level":x,"aria-disabled":f.has(n.id),tabIndex:s===n.id?0:-1,ref:function(e){null!=(null==I?void 0:I.current)&&null!=e&&(I.current[n.id]=e)},className:m.branchWrapper},Q),a.createElement(a.Fragment,null,E({element:n,isBranch:!0,isSelected:d.has(n.id),isHalfSelected:b.has(n.id),isExpanded:u.has(n.id),isDisabled:f.has(n.id),dispatch:l,getNodeProps:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.onClick;return{onClick:null==a?v(K,B,H):v(a,H),className:e(V(m.node),m.branch),ref:function(e){null!=(null==g?void 0:g.current)&&(g.current[n.id]=e)}}},setsize:O,posinset:W,level:x,handleSelect:K,handleExpand:B,treeState:R}),a.createElement(oe,Object.assign({getClasses:V},function(e){e.setsize,e.posinset;return h(e,["setsize","posinset"])}(t))))):a.createElement("li",{role:"none",className:V(m.leafListItem)},E({element:n,isBranch:!1,isSelected:d.has(n.id),isHalfSelected:!1,isExpanded:!1,isDisabled:f.has(n.id),dispatch:l,getNodeProps:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.onClick;return Object.assign({role:"treeitem",tabIndex:s===n.id?0:-1,onClick:v(null==a?K:a,H),ref:function(e){null!=(null==I?void 0:I.current)&&null!=(null==g?void 0:g.current)&&(I.current[n.id]=e,g.current[n.id]=e)},className:e(V(m.node),m.leaf),"aria-setsize":O,"aria-posinset":W,"aria-level":x,disabled:f.has(n.id),"aria-disabled":f.has(n.id)},Q)},setsize:O,posinset:W,level:x,handleSelect:K,handleExpand:p,treeState:R}))},oe=function(e){var t=e.data,n=e.element,l=e.expandedIds,r=e.getClasses,i=e.baseClassNames,s=e.level,c=h(e,["data","element","expandedIds","getClasses","baseClassNames","level"]);return a.createElement("ul",{role:"group",className:r(i.nodeGroup)},l.has(n.id)&&n.children.length>0&&n.children.map((function(e,r){return a.createElement(ce,Object.assign({data:t,expandedIds:l,baseClassNames:i,key:"".concat(e,"-").concat(d(e)),element:F(t,e),setsize:n.children.length,posinset:r+1,level:s+1},c))})))},ue=function(e){var t=e.data,a=e.controlledSelectedIds,d=e.controlledExpandedIds,i=e.defaultExpandedIds,o=e.defaultSelectedIds,u=e.defaultDisabledIds,h=e.nodeRefs,v=e.leafRefs,E=e.onSelect,A=e.onNodeSelect,O=e.onExpand,W=e.onLoadData,x=e.togglableSelect,T=e.multiSelect,j=e.propagateSelect,N=e.propagateSelectUpwards,D=_(t),U=s(r(le,{selectedIds:new Set(a||o),controlledIds:new Set(a),tabbableId:D.children[0],isFocused:!1,expandedIds:new Set(d||i),halfSelectedIds:new Set,lastUserSelect:D.children[0],lastInteractedWith:null,lastManuallyToggled:null,disabledIds:new Set(u)}),2),M=U[0],L=U[1],R=M.selectedIds,q=M.controlledIds,$=M.expandedIds,Q=M.disabledIds,Z=M.tabbableId,ee=M.halfSelectedIds,re=M.lastAction,de=M.lastInteractedWith,ie=M.lastManuallyToggled,se=I(R)||new Set,ce=S(R,se);l((function(){var e;if(null!=E&&E!==p){var a,n=f(ce);try{for(n.s();!(a=n.n()).done;){var l=a.value,r=y(t,l)||!!(null===(e=F(t,Z))||void 0===e?void 0:e.isBranch);E({element:F(t,l),isBranch:r,isExpanded:!!r&&$.has(l),isSelected:R.has(l),isDisabled:Q.has(l),isHalfSelected:!!r&&ee.has(l),treeState:M})}}catch(e){n.e(e)}finally{n.f()}}}),[t,R,$,Q,ee,ce,E,M]),l((function(){null!=A&&A!==p&&null!=ie&&ce.size&&(A({element:F(t,ie),isSelected:R.has(ie),isBranch:y(t,ie),treeState:M}),L({type:te}))}),[ie,R,ce]);var oe=I($)||new Set;l((function(){var e=S($,oe);if(null!=O&&O!==p){var a,n=f(e);try{for(n.s();!(a=n.n()).done;){var l=a.value;O({element:F(t,l),isExpanded:$.has(l),isSelected:R.has(l),isDisabled:Q.has(l),isHalfSelected:ee.has(l),treeState:M})}}catch(e){n.e(e)}finally{n.f()}}}),[t,R,$,Q,ee,oe,O,M]);var ue,fe,he=(ue=t,fe=n(),l((function(){fe.current=ue})),fe.current||new Map);l((function(){var e=S($,oe);if(W){var a,n=f(e);try{for(n.s();!(a=n.n()).done;){var l=a.value;W({element:F(t,l),isExpanded:$.has(l),isSelected:R.has(l),isDisabled:Q.has(l),isHalfSelected:ee.has(l),treeState:M})}}catch(e){n.e(e)}finally{n.f()}if(he!==t&&x&&j){var r,d=f($);try{for(d.s();!(r=d.n()).done;){var i=r.value;R.has(i)&&L({type:X,ids:C(t,[i],Q),select:!0,multiSelect:T,lastInteractedWith:i})}}catch(e){d.e(e)}finally{d.f()}}}}),[t,R,$,Q,ee,oe,W,M]),l((function(){if(he!==t){var e=_(t);e.children.length&&L({type:ne,tabbableId:t.find((function(e){return e.id===M.tabbableId}))?M.tabbableId:e.children[0],lastInteractedWith:t.find((function(e){return e.id===M.lastInteractedWith}))?M.lastInteractedWith:null,lastManuallyToggled:t.find((function(e){return e.id===M.lastManuallyToggled}))?M.lastManuallyToggled:null,lastUserSelect:t.find((function(e){return e.id===M.lastUserSelect}))?M.lastUserSelect:e.children[0]})}}),[t]);var pe=S(new Set(a),q);return l((function(){if(a){pe.size&&L({type:ae,ids:a,multiSelect:T});var e,n=f(a);try{for(n.s();!(e=n.n()).done;){var l=e.value;j&&!Q.has(l)&&L({type:X,ids:C(t,[l],Q),select:!0,multiSelect:T,lastInteractedWith:l})}}catch(e){n.e(e)}finally{n.f()}}}),[a]),l((function(){var e=new Set(d),a=b(e,oe),n=b(oe,e);if(n.size){var l,r=f(n);try{for(r.s();!(l=r.n()).done;){var i=l.value;if(y(t,i)||F(t,i).isBranch){var s=[i].concat(c(w(t,i,new Set)));L({type:z,ids:s,lastInteractedWith:i})}}}catch(e){r.e(e)}finally{r.f()}}if(a.size){var o,u=f(a);try{for(u.s();!(o=u.n()).done;){var h=o.value;if(y(t,h)||F(t,h).isBranch){var p=g(t,h);L(p?{type:K,ids:[h,p],lastInteractedWith:h}:{type:H,id:h,lastInteractedWith:h})}}}catch(e){u.e(e)}finally{u.f()}}}),[d]),l((function(){if(N){var e=new Set([].concat(c(ce),c(q)));de&&re!==J&&re!==B&&re!==H&&re!==Y&&e.add(de);var a=[];e.forEach((function(e){t.find((function(t){return t.id===e}))||a.push(e)})),a.forEach((function(t){return e.delete(t)}));var n,l=function(e,t,a,n,l,r){var d,i={every:new Set,some:new Set,none:new Set},s=f(t);try{for(s.s();!(d=s.n()).done;)for(var c=d.value;;){var o=g(e,c);if(0===o||null==o||null!=o&&n.has(o))break;var u=F(e,o).children.filter((function(e){return!n.has(e)}));if(0===u.length)break;if(u.some((function(e){return a.has(e)||i.some.has(e)||l.has(e)})))u.every((function(e){return a.has(e)}))?i.every.add(o):i.some.add(o);else{var h=m(e,c,n).find((function(e){return a.has(e)}));if(!r&&h){w(e,h,n).forEach((function(e){l.has(e)&&i.none.add(e)}));break}i.none.add(o)}c=o}}catch(e){s.e(e)}finally{s.f()}return i}(t,e,R,Q,ee,T),r=l.every,d=l.some,i=l.none,s=f(r);try{for(s.s();!(n=s.n()).done;){var o=n.value;R.has(o)||L({type:G,id:o,multiSelect:T||k(t,o,R),keepFocus:!0,NotUserAction:!0,lastInteractedWith:de})}}catch(e){s.e(e)}finally{s.f()}var u,h=f(d);try{for(h.s();!(u=h.n()).done;){var p=u.value;ee.has(p)||L({type:P,id:p,lastInteractedWith:de,keepFocus:!0,NotUserAction:!0})}}catch(e){h.e(e)}finally{h.f()}var v,b=f(i);try{for(b.s();!(v=b.n()).done;){var S=v.value;(R.has(S)||ee.has(S))&&L({type:V,id:S,multiSelect:T,keepFocus:!0,NotUserAction:!0,lastInteractedWith:de,lastManuallyToggled:ie})}}catch(e){b.e(e)}finally{b.f()}}}),[t,T,N,R,$,Q,ee,re,se,ce,de,pe]),l((function(){if(null!=de&&null!=Z&&null!=(null==h?void 0:h.current)&&null!=(null==v?void 0:v.current)){var e=h.current[Z];!function(e){null!=e&&e.scrollIntoView&&e.scrollIntoView({block:"nearest"})}(v.current[de]),function(e){null!=e&&e.focus&&e.focus({preventScroll:!0})}(e)}}),[Z,h,v,de]),[M,L]},fe=a.forwardRef((function(t,l){var r=t.data,i=t.selectedIds,c=t.nodeRenderer,o=t.onSelect,u=void 0===o?p:o,f=t.onNodeSelect,v=void 0===f?p:f,b=t.onExpand,S=void 0===b?p:b,I=t.onLoadData,y=t.className,g=void 0===y?"":y,m=t.multiSelect,w=void 0!==m&&m,E=t.propagateSelect,A=void 0!==E&&E,O=t.propagateSelectUpwards,W=void 0!==O&&O,x=t.propagateCollapse,T=void 0!==x&&x,j=t.expandOnKeyboardSelect,N=void 0!==j&&j,D=t.togglableSelect,C=void 0!==D&&D,M=t.defaultExpandedIds,k=void 0===M?[]:M,L=t.defaultSelectedIds,B=void 0===L?[]:L,z=t.defaultDisabledIds,H=void 0===z?[]:z,K=t.clickAction,P=void 0===K?de.select:K,G=t.nodeAction,V=void 0===G?"select":G,Y=t.expandedIds,q=t.onBlur,X=h(t,["data","selectedIds","nodeRenderer","onSelect","onNodeSelect","onExpand","onLoadData","className","multiSelect","propagateSelect","propagateSelectUpwards","propagateCollapse","expandOnKeyboardSelect","togglableSelect","defaultExpandedIds","defaultSelectedIds","defaultDisabledIds","clickAction","nodeAction","expandedIds","onBlur"]);!function(e){if(R(e.map((function(e){return e.id}))))throw Error("Multiple TreeView nodes have the same ID. IDs must be unique.");if(e.forEach((function(e){if(e.id===e.parent)throw Error("Node with id=".concat(e.id," has parent reference to itself."));if(R(e.children))throw Error("Node with id=".concat(e.id," contains duplicate ids in its children."))})),0===e.filter((function(e){return null===e.parent})).length)throw Error("TreeView must have one root node.");if(e.filter((function(e){return null===e.parent})).length>1)throw Error("TreeView can have only one root node.");_(e).children.length||console.warn("TreeView have no nodes to display.")}(r);var $=n({}),J=n({}),Z=s(ue({data:r,controlledSelectedIds:i,controlledExpandedIds:Y,defaultExpandedIds:k,defaultSelectedIds:B,defaultDisabledIds:H,nodeRefs:$,leafRefs:J,onSelect:u,onNodeSelect:v,onExpand:S,onLoadData:I,togglableSelect:C,multiSelect:w,propagateSelect:A,propagateSelectUpwards:W}),2),ee=Z[0],te=Z[1];A=A&&w;var ae=n(null);return null!=l&&(ae=l),a.createElement("ul",Object.assign({className:e(re.root,g),role:"tree","aria-multiselectable":"select"===V?w:void 0,ref:ae,onBlur:function(e){U(e,ae.current,(function(){q&&q({treeState:ee,dispatch:te}),te({type:Q})}))},onKeyDown:he({data:r,tabbableId:ee.tabbableId,expandedIds:ee.expandedIds,selectedIds:ee.selectedIds,disabledIds:ee.disabledIds,halfSelectedIds:ee.halfSelectedIds,clickAction:P,dispatch:te,propagateCollapse:T,propagateSelect:A,multiSelect:w,expandOnKeyboardSelect:N,togglableSelect:C})},X),_(r).children.map((function(e,t){return a.createElement(ce,Object.assign({key:"".concat(e,"-").concat(d(e)),data:r,element:F(r,e),setsize:_(r).children.length,posinset:t+1,level:1},ee,{state:ee,dispatch:te,nodeRefs:$,leafRefs:J,baseClassNames:re,nodeRenderer:c,propagateCollapse:T,propagateSelect:A,propagateSelectUpwards:W,multiSelect:w,togglableSelect:C,clickAction:P,nodeAction:V}))})))})),he=function(e){var t=e.data,a=e.expandedIds,n=e.selectedIds,l=e.disabledIds,r=e.tabbableId,d=e.dispatch,i=e.propagateCollapse,s=e.propagateSelect,o=e.multiSelect,u=e.expandOnKeyboardSelect,f=e.togglableSelect,h=e.clickAction;return function(e){var p=F(t,r),v=p.id;if(e.ctrlKey){if("a"===e.key){e.preventDefault();var b=t.filter((function(e){return null!==e.parent})).map((function(e){return e.id})).filter((function(e){return!l.has(e)}));d({type:X,multiSelect:o,select:Array.from(n).filter((function(e){return!l.has(e)})).length!==b.length,ids:b,lastInteractedWith:p.id})}else if(e.shiftKey&&("Home"===e.key||"End"===e.key)){var S="Home"===e.key?_(t).children[0]:O(t,v,a),I=T({data:t,expandedIds:a,from:v,to:S}).filter((function(e){return!l.has(e)}));d({type:X,multiSelect:o,select:!0,ids:s?C(t,I,l):I}),d({type:J,id:S,lastInteractedWith:S})}}else{if(e.shiftKey)switch(e.key){case"ArrowUp":e.preventDefault();var m=W(t,v,a);return void(null==m||l.has(m)||(d({type:X,ids:s?C(t,[m],l):[m],select:!0,multiSelect:o,lastInteractedWith:m,lastManuallyToggled:m}),d({type:J,id:m,lastInteractedWith:m})));case"ArrowDown":e.preventDefault();var E=x(t,v,a);return void(null==E||l.has(E)||(d({type:X,ids:s?C(t,[E],l):[E],multiSelect:o,select:!0,lastInteractedWith:E,lastManuallyToggled:E}),d({type:J,id:E,lastInteractedWith:E})))}switch(e.key){case"ArrowDown":e.preventDefault();var A=x(t,v,a);return void(null!=A&&d({type:J,id:A,lastInteractedWith:A}));case"ArrowUp":e.preventDefault();var j=W(t,v,a);return void(null!=j&&d({type:J,id:j,lastInteractedWith:j}));case"ArrowLeft":if(e.preventDefault(),(y(t,v)||p.isBranch)&&a.has(r))if(i){var N=[v].concat(c(w(t,v,new Set)));d({type:z,ids:N,lastInteractedWith:p.id})}else d({type:B,id:v,lastInteractedWith:v});else if(!_(t).children.includes(v)){var D=g(t,v);if(null==D)throw new Error("parentId of root element is null");d({type:J,id:D,lastInteractedWith:D})}return;case"ArrowRight":return e.preventDefault(),void((y(t,v)||p.isBranch)&&(a.has(r)?d({type:J,id:p.children[0],lastInteractedWith:p.children[0]}):d({type:H,id:v,lastInteractedWith:v})));case"Home":e.preventDefault(),d({type:J,id:_(t).children[0],lastInteractedWith:_(t).children[0]});break;case"End":e.preventDefault();var U=O(t,_(t).id,a);return void d({type:J,id:U,lastInteractedWith:U});case"*":e.preventDefault();var k=g(t,v);if(null==k)throw new Error("parentId of element is null");var R=F(t,k).children.filter((function(e){return y(t,e)||F(t,e).isBranch}));return void d({type:K,ids:R,lastInteractedWith:v});case"Enter":case" ":case"Spacebar":if(e.preventDefault(),h===de.focus)return;var V=M(t,p.id,n),$=L(t,p.id,n);return d({type:f?V&&!$?P:q:G,id:v,multiSelect:o,lastInteractedWith:v,lastManuallyToggled:v}),s&&!l.has(p.id)&&d({type:X,ids:C(t,[v],l),select:!f||!n.has(v),multiSelect:o,lastInteractedWith:v,lastManuallyToggled:v}),void(u&&d({type:Y,id:v,lastInteractedWith:v}));default:if(1===e.key.length)for(var Q=x(t,v,a);Q!==v;)if(null!=Q){if(F(t,Q).name[0].toLowerCase()===e.key.toLowerCase())return void d({type:J,id:Q,lastInteractedWith:v});Q=x(t,Q,a)}else Q=_(t).children[0];return}}}};fe.propTypes={data:t.array.isRequired,onSelect:t.func,onNodeSelect:t.func,onExpand:t.func,className:t.string,nodeRenderer:t.func.isRequired,defaultExpandedIds:t.array,defaultSelectedIds:t.array,expandedIds:t.array,selectedIds:t.array,defaultDisabledIds:t.array,propagateCollapse:t.bool,propagateSelect:t.bool,propagateSelectUpwards:t.bool,multiSelect:t.bool,expandOnKeyboardSelect:t.bool,togglableSelect:t.bool,nodeAction:t.oneOf(se),clickAction:t.oneOf(ie),onBlur:t.func,onLoadData:t.func};export default fe;export{ie as CLICK_ACTIONS,j as flattenTree};
